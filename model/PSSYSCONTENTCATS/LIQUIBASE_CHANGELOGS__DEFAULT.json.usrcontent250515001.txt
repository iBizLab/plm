<?xml version="1.1" encoding="UTF-8" standalone="no"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext" xmlns:pro="http://www.liquibase.org/xml/ns/pro" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd http://www.liquibase.org/xml/ns/pro http://www.liquibase.org/xml/ns/pro/liquibase-pro-4.6.xsd http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.6.xsd">
<changeSet author="jackwang" id="UsrContent250515001"  failOnError="false">
<sql>
INSERT INTO `guideline` (`CREATE_MAN`, `CREATE_TIME`, `ID`, `IS_ENABLED`, `NAME`, `OBJECT_TYPE`, `REVIEW_ACTION_RULE`, `REVIEW_RULE`, `REVIEW_STAGE`, `SCOPE_ID`, `SUBJECT_TYPE`, `UPDATE_MAN`, `UPDATE_TIME`) VALUES (NULL, null, 'default_product_idea', 1, '需求评审', 'PRODUCT', '[]', '[]', '[{\"reviewer_type\":\"10\",\"stage_state\":\"10\",\"order\":1,\"guideline_id\":\"default_product_idea\",\"id\":\"c27fee68b08cc84897257025795a3510\",\"name\":\"默认阶段\"}]', NULL, 'IDEA', null, null);

INSERT INTO `guideline` 
(
    `CREATE_MAN`, `CREATE_TIME`, `ID`, `IS_ENABLED`, `NAME`, 
    `OBJECT_TYPE`, `REVIEW_ACTION_RULE`, 
    `REVIEW_RULE`, `REVIEW_STAGE`, 
    `SCOPE_ID`, `SUBJECT_TYPE`, 
    `UPDATE_MAN`, `UPDATE_TIME`
)
SELECT 
    null,null, CONCAT(p.`ID`, '_default_product_idea'), 1,  '需求评审', 'PRODUCT', NULL, NULL,  CONCAT('[{\"reviewer_type\":\"10\",\"stage_state\":\"10\",\"order\":1,\"id\":\"', UUID(), '\",\"name\":\"默认阶段\"}]'), p.`ID`, 'IDEA', null, null
FROM  `product` p WHERE NOT EXISTS ( SELECT 1  FROM `guideline` g  WHERE g.`SCOPE_ID` = p.`ID` );
</sql>
</changeSet>
</databaseChangeLog>