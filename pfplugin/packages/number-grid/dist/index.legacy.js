!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t,r){if(a())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,t);var o=new(e.bind.apply(e,n));return r&&l(o,r.prototype),o}function r(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function n(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(t,r,n){return r=c(r),function(t,r){if(r&&("object"==e(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(t,a()?Reflect.construct(r,n||[],c(t).constructor):r.apply(t,n))}function a(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(a=function(){return!!e})()}function i(e,t,r,n){var o=s(c(1&n?e.prototype:e),t,r);return 2&n&&"function"==typeof o?function(e){return o.apply(r,e)}:o}function s(){return s="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},s.apply(null,arguments)}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function d(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */d=function(){return r};var t,r={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(t){l=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var o=t&&t.prototype instanceof w?t:w,i=Object.create(o.prototype),s=new G(n||[]);return a(i,"_invoke",{value:R(e,r,s)}),i}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var p="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function w(){}function b(){}function x(){}var C={};l(C,s,(function(){return this}));var k=Object.getPrototypeOf,E=k&&k(k(N([])));E&&E!==n&&o.call(E,s)&&(C=E);var S=x.prototype=w.prototype=Object.create(C);function D(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function P(t,r){function n(a,i,s,c){var u=h(t[a],t,i);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==e(d)&&o.call(d,"__await")?r.resolve(d.__await).then((function(e){n("next",e,s,c)}),(function(e){n("throw",e,s,c)})):r.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(e,t){function o(){return new r((function(r,o){n(e,t,r,o)}))}return i=i?i.then(o,o):o()}})}function R(e,r,n){var o=p;return function(a,i){if(o===v)throw Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=L(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=h(e,r,n);if("normal"===u.type){if(o=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function L(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=h(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function O(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function G(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(O,this),this.reset(!0)}function N(r){if(r||""===r){var n=r[s];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var a=-1,i=function e(){for(;++a<r.length;)if(o.call(r,a))return e.value=r[a],e.done=!1,e;return e.value=t,e.done=!0,e};return i.next=i}}throw new TypeError(e(r)+" is not iterable")}return b.prototype=x,a(S,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,u,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,l(e,u,"GeneratorFunction")),e.prototype=Object.create(S),e},r.awrap=function(e){return{__await:e}},D(P.prototype),l(P.prototype,c,(function(){return this})),r.AsyncIterator=P,r.async=function(e,t,n,o,a){void 0===a&&(a=Promise);var i=new P(f(e,t,n,o),a);return r.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},D(S),l(S,u,"Generator"),l(S,s,(function(){return this})),l(S,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=N,G.prototype={constructor:G,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(I),!e)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:N(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),g}},r}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,i,s=[],c=!0,u=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(s.push(n.value),s.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e){return function(e){if(Array.isArray(e))return m(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return m(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function v(e,t,r,n,o,a,i){try{var s=e[a](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function y(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function i(e){v(a,n,o,i,s,"next",e)}function s(e){v(a,n,o,i,s,"throw",e)}i(void 0)}))}}function g(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,C(n.key),n)}}function w(e,t,r){return t&&g(e.prototype,t),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t,r){return(t=C(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function C(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}System.register(["@ibiz-template/vue3-util","@ibiz-template/runtime","vue","lodash-es","@ibiz-template/core","qx-util","@floating-ui/dom"],(function(e,r){"use strict";var a,s,c,l,p,m,v,g,C,k,E,S,D,P,R,L,O,I,G,N,A,T,j,_,F,M,z,B,U,V,Q,H,X,q,W;return{setters:[function(e){a=e.useUIStore,s=e.useNamespace,c=e.useControlController,l=e.withInstall},function(e){p=e.Srfuf,m=e.GridRowState,v=e.ControlVO,g=e.TreeGridController,C=e.calcDeCodeNameById,k=e.GridNotifyState,E=e.GridController,S=e.ScriptFactory,D=e.registerControlProvider},function(e){P=e.ref,R=e.computed,L=e.watch,O=e.nextTick,I=e.reactive,G=e.createVNode,N=e.resolveComponent,A=e.defineComponent,T=e.onMounted,j=e.onUnmounted,_=e.createTextVNode,F=e.mergeProps,M=e.h},function(e){z=e.toNumber,B=e.isArray},function(e){U=e.isElementSame,V=e.RuntimeError,Q=e.awaitTimeout,H=e.mergeDefaultInLeft,X=e.RuntimeModelError},function(e){q=e.createUUID},function(e){W=e.computePosition}],execute:function(){var r=w((function e(){b(this,e),x(this,"component","IBizNumberGridControl")}));var $=function(e){function t(){var e;b(this,t);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return x(e=o(this,t,[].concat(n)),"defaultExpandAll",!1),x(e,"expandColumnIndex",void 0),e}return u(t,e),w(t,[{key:"overflowMode",get:function(){return"ellipsis"}},{key:"initState",value:function(){i(t,"initState",this,3)([]),this.state.nodeLoadedMap=new Map;var e="SHOW_MODE_".concat(this.context.project,"_").concat(this.view.model.codeName),r=localStorage.getItem(e);"tree"===r?this.state.showTreeGrid=!0:"grid"===r&&(this.state.showTreeGrid=!1)}},{key:"setSort",value:function(e,t){var r;(e||t)&&(e&&(r=this.fieldIdNameMap.get(e).toLowerCase()),this.state.sortQuery=r&&t?"".concat(r,",").concat(t):"",this.setSortCache())}},{key:"setSortCache",value:function(){this.view&&(this.state.sortQuery?localStorage.setItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"),this.state.sortQuery):localStorage.removeItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")))}},{key:"getFetchParams",value:(E=y(d().mark((function e(t){var r,o,a,i,s,c,u,l,f,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.state,o=r.curPage,a=r.size,i=r.sortQuery,s=r.noSort,c=n({},this.params),a&&(c.page=o-1,c.size=a),s||(i?c.sort=i:(u=this.getSortModel(),l=u.minorSortAppDEFieldId,f=u.minorSortDir,this.view&&localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"))?this.state.sortQuery=localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")):l&&f&&(h=this.fieldIdNameMap.get(l),this.state.sortQuery="".concat(h.toLowerCase(),",").concat(f.toLowerCase())),c.sort=this.state.sortQuery,this.setSortCache())),e.next=6,this.evt.emit("onBeforeLoad",void 0);case 6:return Object.assign(c,n({},this.state.searchParams)),t&&Object.assign(c,t),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"switchShowMode",value:(g=y(d().mark((function e(t){var r;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.showMode)){e.next=6;break}return"tree"===r?this.state.showTreeGrid=!0:"grid"===r&&(this.state.showTreeGrid=!1),this.state.nodeLoadedMap.clear(),e.next=6,this.load();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return g.apply(this,arguments)})},{key:"onCreated",value:(v=y(d().mark((function e(){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t,"onCreated",this,3)([]);case 2:r=this.model.controlParam.ctrlParams,(n=void 0===r?{}:r).DEFAULTEXPANDALL&&(this.defaultExpandAll=Object.is(n.DEFAULTEXPANDALL,"TRUE")||Object.is(n.DEFAULTEXPANDALL,"true")),n.GRIDROWACTIVEMODE&&(this.state.mdctrlActiveMode=JSON.parse(n.GRIDROWACTIVEMODE)),n.EXPANDCOLUMNINDEX&&(this.expandColumnIndex=n.EXPANDCOLUMNINDEX);case 6:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"findChanges",value:function(e,t){var r=this,n=[],o=[],a=[],i=new Map;e.forEach((function(e){return i.set(e.srfkey,e)})),t.forEach((function(e){i.has(e.srfkey)||n.push(e)}));var s=new Map;return t.forEach((function(e){return s.set(e.srfkey,e)})),e.forEach((function(e){s.has(e.srfkey)||o.push(e)})),e.forEach((function(e){var n=t.find((function(t){return t.srfkey===e.srfkey}));e&&n&&e[r.treeGridParentField]!==n[r.treeGridParentField]&&(a.push(e),a.push(n))})),{added:n,removed:o,changed:a}}},{key:"refresh",value:(f=y(d().mark((function e(){var t,r,n,o,a,i,s=this,c=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]&&c[0],r=h(this.state.items),e.next=4,this.load({isInitialLoad:t});case 4:n=this.findChanges(r,this.state.items),o=n.added,a=n.removed,i=n.changed,[].concat(h(o),h(a),h(i)).forEach((function(e){var t=s.state.items.find((function(t){return e[s.treeGridParentField]&&t[s.treeGridValueField]===e[s.treeGridParentField]}));t&&s.state.nodeLoadedMap.has(t.tempsrfkey)&&s.evt.emit("onReloadParentNode",{node:e})}));case 6:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"load",value:(l=y(d().mark((function e(){var t,r,n,o,a,i,s,c,u,l=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.length>0&&void 0!==l[0]?l[0]:{},!this.state.isSimple){e.next=3;break}return e.abrupt("return",[]);case 3:if(r=!0===t.silent){e.next=7;break}return e.next=7,this.startLoading();case 7:return e.prev=7,n=!0===t.isInitialLoad,o=!0===t.isLoadMore,n?this.state.curPage=1:o&&(this.state.curPage+=1),a=this.handlerAbilityParams(t),i=a.context,e.next=14,this.getFetchParams(null==t?void 0:t.viewParam);case 14:return null!=(s=e.sent)&&s.hasOwnProperty("srfshowmode")||this.state.showTreeGrid&&Object.assign(s,{srfshowmode:"tree"}),e.next=18,this.service.fetch(i,s);case 18:return"number"==typeof(c=e.sent).total&&(this.state.total=c.total),"number"==typeof c.totalPages&&(this.state.totalPages=c.totalPages),o?(u=this.state.items).push.apply(u,h(c.data)):this.state.items=c.data,e.next=24,this.afterLoad(t,c.data);case 24:return this.state.isLoaded=!0,e.next=27,this.evt.emit("onLoadSuccess",{isInitialLoad:n});case 27:e.next=35;break;case 29:return e.prev=29,e.t0=e.catch(7),e.next=33,this.evt.emit("onLoadError",void 0);case 33:throw this.actionNotification("FETCHERROR",{error:e.t0}),e.t0;case 35:if(e.prev=35,r){e.next=39;break}return e.next=39,this.endLoading();case 39:return e.finish(35);case 40:return this.state.items.forEach((function(e,t){e.srfserialnum=t+1})),this.actionNotification("FETCHSUCCESS"),e.abrupt("return",this.state.items);case 43:case"end":return e.stop()}}),e,this,[[7,29,35,40]])}))),function(){return l.apply(this,arguments)})},{key:"afterLoad",value:(c=y(d().mark((function e(r,n){var o,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t,"afterLoad",this,3)([r,n]);case 2:return!0===r.isInitialLoad?this.state.selectedData=[]:(o=this.state.selectedData.filter((function(e){return a.state.items.find((function(t){return e.tempsrfkey===t.tempsrfkey}))})),this.state.selectedData=o),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"save",value:(s=y(d().mark((function e(t){var r,n,o,a,i,s;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.state.isSimple){e.next=2;break}return e.abrupt("return");case 2:if(r=t.srfuf===p.CREATE,n=this.findRowState(t)){e.next=6;break}throw new V("行数据不存在");case 6:if(n.modified){e.next=9;break}return ibiz.log.debug("值没有发生改变"),e.abrupt("return");case 9:if(!n.processing){e.next=13;break}return e.next=12,Q(500,this.save.bind(this),[t]);case 12:return e.abrupt("return");case 13:return e.next=15,this.validate(n);case 15:if(e.sent){e.next=18;break}throw new V("行数据校验不通过，保存取消");case 18:if(a=C(this.model.appDataEntityId),(i=this.context.clone())[a]=t.srfkey,e.prev=21,!r){e.next=28;break}return e.next=25,this.service.create(i,t);case 25:e.t0=e.sent,e.next=31;break;case 28:return e.next=30,this.service.update(i,t);case 30:e.t0=e.sent;case 31:o=e.t0,e.next=43;break;case 34:if(e.prev=34,e.t1=e.catch(21),!r){e.next=39;break}return e.next=39,this.remove({data:[t],silent:!0});case 39:return e.next=41,this.evt.emit("onSaveError",void 0);case 41:throw this.actionNotification("".concat(r?"CREATE":"UPDATE","ERROR"),{error:e.t1,data:n.data}),e.t1;case 43:return s=this.findRowStateIndex(t),this.state.items.splice(s,1,o.data),n.data=o.data,n.modified=!1,r&&this.evt.emit("onReloadParentNode",{node:o.data}),this.gridStateNotify(n,k.SAVE),e.next=51,this.evt.emit("onSaveSuccess",void 0);case 51:case"end":return e.stop()}}),e,this,[[21,34]])}))),function(e){return s.apply(this,arguments)})},{key:"afterRemove",value:function(e){var t=this.state.items.findIndex((function(t){return t.srfkey===e.srfkey}));-1!==t&&this.state.items.splice(t,1);var r=this.findRowStateIndex(e);this.state.rows.splice(r,1),this.state.groups.forEach((function(t){if(t.children.length){var r=t.children.findIndex((function(t){return t.srfkey===e.srfkey}));-1!==r&&t.children.splice(r,1)}})),this.evt.emit("onReloadParentNode",{node:e})}},{key:"newRow",value:(a=y(d().mark((function e(){var t,r,o,a,i,s,c,u,l=arguments;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(l.length>0&&void 0!==l[0]?l[0]:{}).data,r=ibiz.config.grid.editShowMode,o={},t&&(o=Array.isArray(t)?t[0]:t),"row"!==r){e.next=9;break}if(!this.state.rows.find((function(e){return e.showRowEdit}))){e.next=9;break}throw new V("请先完成当前行编辑中的行的操作");case 9:return a=n({},this.params),i=this.calcDefaultValue(o||{},!0),o.srfDefaultData&&Object.assign(i,o.srfDefaultData),Object.assign(a,i),e.prev=13,e.next=16,this.service.getDraft(this.context,a);case 16:s=e.sent,e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(13),this.actionNotification("GETDRAFTERROR",{error:e.t0}),e.t0;case 23:c=s.data,H(c,i),c[this.treeGridParentField]=o[this.treeGridValueField],o.srfUserData&&(c.srfUserData=o.srfUserData),this.state.items.push(c),u=new m(c,this),this.state.rows.push(u),this.gridStateNotify(u,k.DRAFT),"row"===r&&this.switchRowEdit(u,!0),this.evt.emit("onReloadParentNode",{node:c}),this.actionNotification("GETDRAFTSUCCESS",{data:c});case 34:case"end":return e.stop()}}),e,this,[[13,19]])}))),function(){return a.apply(this,arguments)})},{key:"onRowClick",value:(r=y(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.singleSelect&&this.setSelection([t]),1!==this.state.mdctrlActiveMode){e.next=4;break}return e.next=4,this.setActive(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]);var r,a,s,c,l,f,v,g,E}(g),Y=function(e){function t(){var e;b(this,t);for(var r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return x(e=o(this,t,[].concat(n)),"codeListItems",void 0),x(e,"defaultExpandAll",!1),e}return u(t,e),w(t,[{key:"onCreated",value:(l=y(d().mark((function e(){var r,n;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t,"onCreated",this,3)([]);case 2:r=this.model.controlParam.ctrlParams,(n=void 0===r?{}:r).DEFAULTEXPANDALL&&(this.defaultExpandAll=Object.is(n.DEFAULTEXPANDALL,"TRUE")||Object.is(n.DEFAULTEXPANDALL,"true"));case 4:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"setSort",value:function(e,t){var r;(e||t)&&(e&&(r=this.fieldIdNameMap.get(e).toLowerCase()),this.state.sortQuery=r&&t?"".concat(r,",").concat(t):"",this.setSortCache())}},{key:"setSortCache",value:function(){this.view&&(this.state.sortQuery?localStorage.setItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"),this.state.sortQuery):localStorage.removeItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")))}},{key:"getFetchParams",value:(c=y(d().mark((function e(t){var r,o,a,i,s,c,u,l,f,h;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.state,o=r.curPage,a=r.size,i=r.sortQuery,s=r.noSort,c=n({},this.params),a&&(c.page=o-1,c.size=a),s||(i?c.sort=i:(u=this.getSortModel(),l=u.minorSortAppDEFieldId,f=u.minorSortDir,this.view&&localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"))?this.state.sortQuery=localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")):l&&f&&(h=this.fieldIdNameMap.get(l),this.state.sortQuery="".concat(h.toLowerCase(),",").concat(f.toLowerCase())),c.sort=this.state.sortQuery,this.setSortCache())),e.next=6,this._evt.emit("onBeforeLoad",void 0);case 6:return Object.assign(c,n({},this.state.searchParams)),t&&Object.assign(c,t),e.abrupt("return",c);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return c.apply(this,arguments)})},{key:"initGroup",value:(s=y(d().mark((function e(){var t,r,n,o;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.model,r=t.groupCodeListId,n=t.groupMode,!t.enableGroup){e.next=9;break}if("CODELIST"!==n){e.next=9;break}if(r){e.next=5;break}throw new X(this.model,"代码表分组模式需要配置代码表");case 5:return o=ibiz.hub.getApp(this.context.srfappid),e.next=8,o.codeList.get(r,this.context,this.params);case 8:this.codeListItems=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"calcGroupData",value:function(e){var t=this,r=this.model,n=r.enableGroup,o=r.groupMode,a=r.groupAppDEFieldId;if(n&&a){var i=new Map,s="CODELIST"===o,c=a.toLowerCase();s&&this.codeListItems.forEach((function(e){i.set(e.value,[])})),e.forEach((function(e){var t=e[c];s||i.has(t)||i.set(t,[]),i.has(t)&&i.get(t).push(e)})),this.state.groups=[],i.forEach((function(e,r){var n,o=null===(n=t.codeListItems)||void 0===n?void 0:n.find((function(e){return e.value===r}));t.state.groups.push({caption:(null==o?void 0:o.text)||"".concat(r||"其他"),groupIcon:null==o?void 0:o.sysImage,key:r,children:e})}))}}},{key:"afterLoad",value:(a=y(d().mark((function e(r,n){var o,a=this;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i(t,"afterLoad",this,3)([r,n]);case 2:return!0===r.isInitialLoad?this.state.selectedData=[]:(o=this.state.selectedData.filter((function(e){return a.state.items.find((function(t){return e.tempsrfkey===t.tempsrfkey}))})),this.state.selectedData=o),e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"onRowClick",value:(r=y(d().mark((function e(t){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.singleSelect&&this.setSelection([t]),1!==this.state.mdctrlActiveMode){e.next=4;break}return e.next=4,this.setActive(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})}]);var r,a,s,c,l}(E);function J(e,t){var r,o={};return null===(r=e.controlAttributes)||void 0===r||r.forEach((function(e){e.attrName&&e.attrValue&&(o[e.attrName]=S.execSingleLine(e.attrValue,n({},t)))})),o}function K(e,t,r,o){if("GROUPGRIDCOLUMN"===t.columnType){var a,i,s=(null===(a=t.degridColumns)||void 0===a?void 0:a.filter((function(e){return!e.hideDefault})))||[],c=t.width,u=(null===(i=t.align)||void 0===i?void 0:i.toLowerCase())||"center";return G(N("el-table-column"),{prop:t.codeName,label:t.caption,"min-width":c,align:u},{default:function(){return s.map((function(t,n){return K(e,t,r,n)}))}})}return function(e,t,r,o){var a,i=t.codeName,s=e.columns[i],c=e.state.columnStates.find((function(e){return e.key===i})),u=r.find((function(t){return e.columns[t.codeName].isAdaptiveColumn})),l=s.isAdaptiveColumn||!u&&o===r.length-1?"min-width":"width",d="default";null!=e&&e.expandColumnIndex&&o<z(null==e?void 0:e.expandColumnIndex)&&(d="");var f=t.width,h=e.model.hideHeader;e.model.enableCustomized&&!h&&f&&o===r.length-1&&(f+=20);var p=(null==c?void 0:c.columnWidth)||f;return G(N("el-table-column"),F({label:t.caption,prop:i},x({},l,p),{fixed:c.fixed,sortable:!!t.enableSort&&"custom",align:(null===(a=t.align)||void 0===a?void 0:a.toLowerCase())||"center",type:d}),{default:function(r){var a=r.row,c=a;if(a.isGroupData)return 0!==o?null:G("div",{class:"group-column"},[G(N("iBizIcon"),{class:"group-icon",icon:a.groupIcon},null),a.caption]);var u=e.findRowState(c);if(u){var l=N(e.providers[i].component);return M(l,{controller:s,row:u,key:c.tempsrfkey+i,attrs:J(t,n(n({},e.getEventArgs()),{},{data:u.data}))})}return G("div",null,null)}})}(e,t,r,o)}var Z=A({name:"IBizNumberGridControl",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object},mdctrlActiveMode:{type:Number,default:void 0},singleSelect:{type:Boolean,default:void 0},rowEditOpen:{type:Boolean,default:void 0},isSimple:{type:Boolean,required:!1},data:{type:Array,required:!1},loadDefault:{type:Boolean,default:!0}},setup:function(e){var r;r="TREEGRID"===e.modelData.controlType?c((function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t($,r)})):c((function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return t(Y,r)}));var n=a().zIndex;r.state.zIndex=n.increment();var o=s("control-grid"),i=R((function(){if("TREEGRID"===e.modelData.controlType)return s("control-".concat(r.model.controlType.toLowerCase()))})),u=s("number-grid"),l=function(e,t){var r=t.modelData.controlParam,n=function(){t.data&&(e.state.items=t.data,e.state.rows=t.data.map((function(t){return new m(new v(t),e)})))},o=R((function(){var t,r=Object.values(e.fieldColumns).find((function(t){return t.model.appDEFieldId===e.model.minorSortAppDEFieldId}));return{prop:null==r?void 0:r.model.codeName,order:"desc"===(null===(t=e.model.minorSortDir)||void 0===t?void 0:t.toLowerCase())?"descending":"ascending"}}));e.evt.on("onCreated",y(d().mark((function r(){return d().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.isSimple&&(n(),e.state.isLoaded=!0);case 1:case"end":return r.stop()}}),r)})))),L((function(){return t.data}),(function(){t.isSimple&&n()}),{deep:!0});var a=R((function(){var t=e.state,n={appId:e.context.srfappid,cssClass:"cube-outline"};if(r&&r.ctrlParams&&r.ctrlParams.GROUPICON&&(n.cssClass=r.ctrlParams.GROUPICON),e.model.enableGroup){var o=[];return t.groups.forEach((function(e){if(e.children.length){e.groupIcon&&(n=e.groupIcon);var t=h(e.children),r=q();o.push({tempsrfkey:r,srfkey:r,isGroupData:!0,caption:e.caption,_children:t,groupIcon:n})}})),o}return t.rows.map((function(e){return e.data}))})),i=R((function(){if(e.isMultistageHeader)return e.model.degridColumns||[];var t=[];return e.state.columnStates.forEach((function(r){var n,o;if(!r.hidden){var a=(null===(n=e.fieldColumns[r.key])||void 0===n?void 0:n.model)||(null===(o=e.uaColumns[r.key])||void 0===o?void 0:o.model);a&&t.push(a)}})),t}));return{tableData:a,renderColumns:i,defaultSort:o,summaryMethod:function(t){return t.columns.map((function(t,r){return 0===r?e.aggTitle:e.state.aggResult[t.property]}))},headerDragend:function(t,r,n){var o=n.property,a=e.columns[o],s=e.state.columnStates.find((function(e){return e.key===o}));if(a.isAdaptiveColumn){s&&(s.adaptive=!1),a.isAdaptiveColumn=!1,a.model.width=t;var c=i.value.findIndex((function(t){return e.columns[t.codeName].isAdaptiveColumn}));e.hasAdaptiveColumn=-1!==c}s&&(s.columnWidth=t,e.saveColumnStates())}}}(r,e),g=l.tableData,w=l.renderColumns,b=l.defaultSort,C=l.summaryMethod,k=l.headerDragend,E=function(e){var t=P(),r=P([]),n=R((function(){return e.state.items.map((function(t){return t._hasChildren=e.state.items.some((function(r){return t[e.treeGridValueField]&&t[e.treeGridValueField]===r[e.treeGridParentField]})),t._children=[],t}))})),o=R((function(){var t=e.state.items.map((function(t){return t[e.treeGridValueField]}));return n.value.filter((function(r){return!r[e.treeGridParentField]||!t.includes(r[e.treeGridParentField])}))}));function a(){return(a=y(d().mark((function t(r,n,o){var a;return d().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.model.enableGroup||!r.isGroupData){t.next=2;break}return t.abrupt("return");case 2:if(r.srfuf!==p.CREATE){t.next=4;break}return t.abrupt("return");case 4:if("row"!==ibiz.config.grid.editShowMode||!e.model.enableRowEdit){t.next=11;break}if(!(a=e.findRowState(r))||!0===a.showRowEdit){t.next=9;break}return t.next=9,e.switchRowEdit(a,!0);case 9:t.next=12;break;case 11:e.onRowClick(r);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function i(){return e.model.enableGroup?r.value.filter((function(e){return!e.isGroupData})):h(r.value)}return L([function(){return t.value},function(){return e.state.isLoaded},function(){return e.state.selectedData}],(function(n){var o=f(n,3),a=o[0],s=o[1],c=o[2];s&&a&&(U(c,i())||(r.value=c),e.state.singleSelect&&(c[0]?t.value.setCurrentRow(c[0],!0):t.value.setCurrentRow()))})),L((function(){return e.state.sortQuery}),(function(r){if(r){var n=e.state.sortQuery.split(",")[0],o=e.state.sortQuery.split(",")[1];if(n&&o){var a="desc"===o?"descending":"ascending",i=function(){t.value?O((function(){t.value.sort(n,a)})):setTimeout(i,500)};i()}}})),{tableRef:t,treeGirdData:o,treeNodeData:n,curSelectedData:r,getSelection:i,onRowClick:function(e,t,r){return a.apply(this,arguments)},onDbRowClick:function(t){e.model.enableGroup&&t.isGroupData||t.srfuf!==p.CREATE&&e.onDbRowClick(t)},isSelected:function(e){return!!r.value.find((function(t){return e.tempsrfkey===t.tempsrfkey}))},onSortChange:function(t){var r,n=t.prop,o=t.order,a=e.fieldColumns[n].model.appDEFieldId;"ascending"===o?r="asc":"descending"===o&&(r="desc"),"".concat(a,",").concat(r)!==e.state.sortQuery&&(e.setSort(a,r),e.load())},handleRowClassName:function(t){var n=t.row,o="";r.value.length>0&&r.value.forEach((function(e){e.tempsrfkey===n.tempsrfkey&&(o="current-row")}));var a=e.findRowState(n);return null!=a&&a.showRowEdit&&(o+=" editing-row"),n.srfkey&&(o+=" id-".concat(n.srfkey)),o},handleHeaderCellClassName:function(t){t._row;var r,n=t.column,o=(t._rowIndex,t._columnIndex,null===(r=e.model.degridColumns)||void 0===r?void 0:r.find((function(e){return e.codeName===n.property})));return o&&o.headerSysCss&&o.headerSysCss.cssName?o.headerSysCss.cssName:""}}}(r),S=E.tableRef,D=E.treeGirdData,A=E.treeNodeData,M=E.curSelectedData,z=E.onRowClick,Q=E.onDbRowClick,H=E.onSortChange,X=E.isSelected,J=E.getSelection,K=E.handleRowClassName,Z=E.handleHeaderCellClassName,ee=function(e){return{onPageChange:function(t){t&&t!==e.state.curPage&&(e.state.curPage=t,e.load())},onPageSizeChange:function(t){t&&t!==e.state.size&&(e.state.size=t,1===e.state.curPage&&e.load())},onPageRefresh:function(){e.load()}}}(r),te=ee.onPageChange,re=ee.onPageRefresh,ne=ee.onPageSizeChange,oe=R((function(){return"TREEGRID"===e.modelData.controlType&&r.state.showTreeGrid})),ae=function(){setTimeout((function(){if(S.value){var e=S.value.$el.getElementsByClassName("el-table__row"),t=0;e.forEach((function(e){var n=e.firstChild.getElementsByClassName("ibiz-number-grid__number--caption")[0];"none"!==e.style.display&&n&&(n.innerText="".concat((r.state.curPage-1)*r.state.size+(t+1)),t++)}))}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)};T((function(){var e=r.model,t=e.controlType,n=e.enableGroup;r.evt.on("onLoadSuccess",(function(){("TREEGRID"===t||"GRID"===t&&n)&&ae()}))})),L((function(){return oe.value}),(function(e,t){e!==t&&(M.value=[],r.setSelection([]))}));var ie=function(){var e=[];return oe.value?e=function(){var e=h(D.value),t=function(n){var o=r.state.items.filter((function(e){return e[r.treeGridParentField]&&n[r.treeGridValueField]===e[r.treeGridParentField]}));o.length>0&&(e.push.apply(e,h(o)),o.forEach((function(e){t(e)})))};return D.value.forEach((function(e){t(e)})),e}():(e=h(g.value),r.model.enableGroup&&g.value.forEach((function(t){var r;(r=e).push.apply(r,h(t._children))}))),e},se=function(){var e=ie(),t=!1;e.length>0&&(t=0===e.filter((function(e){return!X(e)})).length);return t},ce=function(e){!function(e,t){var n=r.model,o=n.controlType,a=n.enableGroup,i=e.findIndex((function(e){return e.tempsrfkey===t.tempsrfkey}));-1!==i?(e.splice(i,1),"GRID"===o&&a&&(B(t._children)?t._children.forEach((function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)})):g.value.forEach((function(t){var r=t._children.find((function(t){return!e.includes(t)})),n=e.findIndex((function(e){return e.tempsrfkey===t.tempsrfkey}));r&&-1!==n&&e.splice(n,1)})))):(e.push(t),"GRID"===o&&a&&(B(t._children)?t._children.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})):g.value.forEach((function(t){var r=t._children.find((function(t){return!e.includes(t)})),n=e.findIndex((function(e){return e.tempsrfkey===t.tempsrfkey}));r||-1!==n||e.unshift(t)}))))}(M.value,e),r.setSelection(J())},ue=function(e,t,n){r.state.nodeLoadedMap.has(e.tempsrfkey)||r.state.nodeLoadedMap.set(e.tempsrfkey,{tree:e,treeNode:t,resolve:n});var o=A.value.filter((function(t){return e[r.treeGridValueField]===t[r.treeGridParentField]}));e._children=o,n(o)};r.evt.on("onReloadParentNode",(function(e){var t=A.value.find((function(t){return e.node[r.treeGridParentField]&&t[r.treeGridValueField]===e.node[r.treeGridParentField]}));t&&(t._hasChildren?function(e){if(r.state.nodeLoadedMap.has(e.tempsrfkey)){var t=r.state.nodeLoadedMap.get(e.tempsrfkey);ue(t.tree,t.treeNode,t.resolve)}else setTimeout((function(){S.value.store.loadOrToggle(e)}),0)}(t):(S.value.toggleRowExpansion(t,!1),delete S.value.store.states.lazyTreeNodeMap.value[t.tempsrfkey]))}));var le=function(e,t){var r,n=P(!1),o=P(),a=I({}),i=function(t){if(!e.value)throw new V("找不到表格组件引用");var r=e.value.$el,n=".editing-row";t.data.srfkey&&(n+=".id-".concat(t.data.srfkey));var o=r.querySelector(n);if(!o)throw new V("找不到对应的表格行dom元素");return o},s=function(){var e=y(d().mark((function e(t){var s,c,u,l,f;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i(t),r){e.next=3;break}throw new V("拿不到pop组件的实例");case 3:return c=r.$el,e.next=6,W(s,c,{placement:"bottom"});case 6:u=e.sent,l=u.x,f=u.y,Object.assign(a,{top:"".concat(f,"px"),left:"".concat(l,"px")}),o.value=t,n.value=!0;case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=y(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.value&&t.switchRowEdit(o.value,!1,!0);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),u=function(){var e=y(d().mark((function e(){return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.value&&t.switchRowEdit(o.value,!1,!1);case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return t.evt.on("onRowEditChange",(function(e){e.row.showRowEdit?setTimeout((function(){s(e.row)}),0):(o.value=void 0,n.value=!1,Object.assign(a,{top:void 0,left:void 0}))})),{renderPopover:function(){var e=n.value&&t.state.rows[t.state.rows.length-1].showRowEdit;return[G("div",{class:"row-edit-popover__placeholder",style:{display:e?"block":"none"}},null),G(N("iBizRowEditPopover"),{ref:function(e){r=e},style:a,show:n.value,onConfirm:c,onCancel:u},null)]}}}(S,r),de=le.renderPopover;return j((function(){n.decrement()})),{c:r,ns:o,ns2:i,ns3:u,tableRef:S,tableData:g,treeGirdData:D,showTreeGrid:oe,renderColumns:w,defaultSort:b,loadData:ue,onDbRowClick:Q,onRowClick:z,onExpandChange:function(e,t){ae()},onSortChange:H,onPageChange:te,onPageSizeChange:ne,onPageRefresh:re,handleRowClassName:K,handleHeaderCellClassName:Z,renderNoData:function(){if(r.state.isLoaded){var e,t=null===(e=r.model.controls)||void 0===e?void 0:e.find((function(e){return e.name==="".concat(r.model.name,"_quicktoolbar")}));return t?G(N("iBizToolbarControl"),{modelData:t,context:r.context,params:r.params,class:o.b("quick-toolbar")},null):G(N("iBizNoData"),{text:r.model.emptyText,emptyTextLanguageRes:r.model.emptyTextLanguageRes},null)}return null},summaryMethod:C,headerDragend:k,renderPopover:de,renderBatchToolBar:function(){var e,t=null===(e=r.model.controls)||void 0===e?void 0:e.find((function(e){return e.name==="".concat(r.model.name,"_batchtoolbar")}));if(t&&!r.state.singleSelect)return G("div",{class:[o.b("batch-toolbar"),u.b("batch-toolbar"),o.is("show",r.state.selectedData.length>0)]},[G("div",{class:o.b("batch-toolbar-content")},[G("div",{class:o.b("batch-toolbar-text")},[_("已选中"),r.state.selectedData.length,_("项")]),G("div",{class:o.b("batch-toolbar-separator")},[_("|")]),G(N("iBizToolbarControl"),{modelData:t,context:r.context,params:r.params,class:o.b("batch-toolbar-items")},null)])])},renderFirstColumn:function(){var e=w.value.length?"width":"min-width";return G(N("el-table-column"),F({"class-name":u.e("first-column")},x({},e,80),{align:"center",fixed:"left",type:"index"}),{header:function(){return G("div",{class:u.e("number")},[r.state.singleSelect?G("span",null,[_("序号")]):G(N("el-checkbox"),{size:"large",indeterminate:r.state.selectedData.length>0&&!se(),modelValue:se(),onChange:function(){return e=ie(),t=M.value.filter((function(t){return!e.find((function(e){return e.tempsrfkey===t.tempsrfkey}))})),se()||t.push.apply(t,h(e)),M.value=t,void r.setSelection(J());var e,t}},null)])},default:function(e){var t=e.row,n=(e.column,e.$index),o=(r.state.curPage-1)*r.state.size+(n+1);return G("div",{class:[u.e("number"),u.is("multiple",!r.state.singleSelect),u.is("single",r.state.singleSelect)],onClick:function(e){return function(e){e.stopPropagation()}(e)}},[G("span",{class:u.em("number","caption")},[o]),!r.state.singleSelect&&G(N("el-checkbox"),{size:"large",class:u.em("number","checkbox"),modelValue:X(t),onChange:function(){return ce(t)}},null)])}})}}},render:function(){var e,t=this;if(this.c.state.isCreated){var r=this.c.state,n=this.c.model,o=n.hideHeader,a=n.enablePagingBar;return G(N("iBizControlBase"),{class:[this.ns.b(),null===(e=this.ns2)||void 0===e?void 0:e.b(),this.ns3.b(),this.ns.is("show-header",!o),this.ns.is("enable-page",a),this.ns.is("enable-group",this.c.model.enableGroup),this.ns.is("single-select",r.singleSelect),this.ns.is("enable-customized",this.c.model.enableCustomized)],controller:this.c},{default:function(){return[G(N("el-table"),{border:!0,ref:"tableRef","row-key":"tempsrfkey",class:t.ns.e("table"),"default-sort":t.defaultSort,"show-header":!o,"show-summary":t.c.enableAgg,"summary-method":t.summaryMethod,"highlight-current-row":r.singleSelect,"row-class-name":t.handleRowClassName,"header-cell-class-name":t.handleHeaderCellClassName,data:t.showTreeGrid?t.treeGirdData:t.tableData,onRowClick:t.onRowClick,onRowDblclick:t.onDbRowClick,onSortChange:t.onSortChange,onExpandChange:t.onExpandChange,onHeaderDragend:t.headerDragend,"tooltip-effect":"light","default-expand-all":t.c.defaultExpandAll,"tree-props":{children:"_children",hasChildren:"_hasChildren"},load:t.loadData,lazy:t.showTreeGrid},{empty:t.renderNoData,default:function(){return[t.renderFirstColumn(),t.renderColumns.map((function(e,r){return K(t.c,e,t.renderColumns,r)}))]},append:function(){return t.renderPopover()}}),a&&G(N("iBizPagination"),{total:r.total,curPage:r.curPage,size:r.size,totalPages:r.totalPages,onChange:t.onPageChange,onPageSizeChange:t.onPageSizeChange,onPageRefresh:t.onPageRefresh},null),t.c.model.enableCustomized&&!o&&G("div",{class:[t.ns.b("setting-box"),t.ns3.b("setting-box")]},[G(N("iBizGridSetting"),{columnStates:r.columnStates,controller:t.c},null)]),t.renderBatchToolBar()]}})}}}),ee=e("IBizNumberGridControl",l(Z,(function(e){e.component(Z.name,Z),D("GRID_RENDER_NUMBER_GRID",(function(){return new r}))})));e("default",{install:function(e){e.use(ee)}})}}}))}();
