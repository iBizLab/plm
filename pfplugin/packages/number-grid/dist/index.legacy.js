!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,r,n){return e=u()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var o=new(Function.bind.apply(t,n));return r&&i(o,r.prototype),o},e.apply(null,arguments)}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach((function(e){x(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(){return o="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},o.apply(this,arguments)}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&i(t,e)}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}function s(e){var r=u();return function(){var n,o=l(e);if(r){var a=l(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return function(e,r){if(r&&("object"===t(r)||"function"==typeof r))return r;if(void 0!==r)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}(this,n)}}function c(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function l(t){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},l(t)}function f(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */f=function(){return r};var e,r={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(e){l=function(t,e,r){return t[e]=r}}function d(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,i=Object.create(o.prototype),s=new G(n||[]);return a(i,"_invoke",{value:P(t,r,s)}),i}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=d;var p="suspendedStart",m="suspendedYield",v="executing",y="completed",g={};function w(){}function b(){}function x(){}var C={};l(C,s,(function(){return this}));var E=Object.getPrototypeOf,S=E&&E(E(T([])));S&&S!==n&&o.call(S,s)&&(C=S);var k=x.prototype=w.prototype=Object.create(C);function D(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function R(e,r){function n(a,i,s,c){var u=h(e[a],e,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==t(f)&&o.call(f,"__await")?r.resolve(f.__await).then((function(t){n("next",t,s,c)}),(function(t){n("throw",t,s,c)})):r.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,c)}))}c(u.arg)}var i;a(this,"_invoke",{value:function(t,e){function o(){return new r((function(r,o){n(t,e,r,o)}))}return i=i?i.then(o,o):o()}})}function P(t,r,n){var o=p;return function(a,i){if(o===v)throw new Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=O(s,n);if(c){if(c===g)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=v;var u=h(t,r,n);if("normal"===u.type){if(o=n.done?y:m,u.arg===g)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=y,n.method="throw",n.arg=u.arg)}}}function O(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,O(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),g;var a=h(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,g;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,g):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,g)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function I(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function G(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function T(r){if(r||""===r){var n=r[s];if(n)return n.call(r);if("function"==typeof r.next)return r;if(!isNaN(r.length)){var a=-1,i=function t(){for(;++a<r.length;)if(o.call(r,a))return t.value=r[a],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw new TypeError(t(r)+" is not iterable")}return b.prototype=x,a(k,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:b,configurable:!0}),b.displayName=l(x,u,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,l(t,u,"GeneratorFunction")),t.prototype=Object.create(k),t},r.awrap=function(t){return{__await:t}},D(R.prototype),l(R.prototype,c,(function(){return this})),r.AsyncIterator=R,r.async=function(t,e,n,o,a){void 0===a&&(a=Promise);var i=new R(d(t,e,n,o),a);return r.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},D(k),l(k,u,"Generator"),l(k,s,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=T,G.prototype={constructor:G,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var r in this)"t"===r.charAt(0)&&o.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&o.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),I(r),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;I(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:T(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),g}},r}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,s=[],c=!0,u=!1;try{if(a=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function v(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(u){return void r(u)}s.done?e(c):Promise.resolve(c).then(n,o)}function y(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){v(a,n,o,i,s,"next",t)}function s(t){v(a,n,o,i,s,"throw",t)}i(void 0)}))}}function g(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,C(n.key),n)}}function w(t,e,r){return e&&g(t.prototype,e),r&&g(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e,r){return(e=C(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function C(e){var r=function(e,r){if("object"!==t(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,r||"default");if("object"!==t(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===t(r)?r:String(r)}System.register(["@ibiz-template/vue3-util","@ibiz-template/runtime","vue","lodash-es","@ibiz-template/core","qx-util","@floating-ui/dom"],(function(t,r){"use strict";var i,u,p,m,v,g,C,E,S,k,D,R,P,O,L,I,G,T,A,N,j,_,F,z,M,B,U,Q,V,H,X,q,$,W,Y;return{setters:[function(t){i=t.useUIStore,u=t.useNamespace,p=t.useControlController,m=t.withInstall},function(t){v=t.Srfuf,g=t.GridRowState,C=t.ControlVO,E=t.TreeGridController,S=t.calcDeCodeNameById,k=t.GridNotifyState,D=t.GridController,R=t.ScriptFactory,P=t.registerControlProvider},function(t){O=t.ref,L=t.computed,I=t.watch,G=t.nextTick,T=t.reactive,A=t.createVNode,N=t.resolveComponent,j=t.defineComponent,_=t.onMounted,F=t.onUnmounted,z=t.createTextVNode,M=t.mergeProps,B=t.h},function(t){U=t.toNumber,Q=t.isArray},function(t){V=t.isElementSame,H=t.RuntimeError,X=t.awaitTimeout,q=t.mergeDefaultInLeft,$=t.RuntimeModelError},function(t){W=t.createUUID},function(t){Y=t.computePosition}],execute:function(){var r=w((function t(){b(this,t),x(this,"component","IBizNumberGridControl")}));var J=function(t){a(R,t);var e,r,i,u,d,p,m,C,E,D=s(R);function R(){var t;b(this,R);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return x(c(t=D.call.apply(D,[this].concat(r))),"defaultExpandAll",!1),x(c(t),"expandColumnIndex",void 0),t}return w(R,[{key:"overflowMode",get:function(){return"ellipsis"}},{key:"initState",value:function(){o(l(R.prototype),"initState",this).call(this),this.state.treeData=[];var t="SHOW_MODE_".concat(this.context.project,"_").concat(this.view.model.codeName),e=localStorage.getItem(t);"tree"===e?this.state.showTreeGrid=!0:"grid"===e&&(this.state.showTreeGrid=!1)}},{key:"setSort",value:function(t,e){var r;(t||e)&&(t&&(r=this.fieldIdNameMap.get(t).toLowerCase()),this.state.sortQuery=r&&e?"".concat(r,",").concat(e):"",this.setSortCache())}},{key:"setSortCache",value:function(){this.view&&(this.state.sortQuery?localStorage.setItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"),this.state.sortQuery):localStorage.removeItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")))}},{key:"getFetchParams",value:(E=y(f().mark((function t(e){var r,o,a,i,s,c,u,l,d,h;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.state,o=r.curPage,a=r.size,i=r.sortQuery,s=r.noSort,c=n({},this.params),a&&(c.page=o-1,c.size=a),s||(i?c.sort=i:(u=this.getSortModel(),l=u.minorSortAppDEFieldId,d=u.minorSortDir,this.view&&localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"))?this.state.sortQuery=localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")):l&&d&&(h=this.fieldIdNameMap.get(l),this.state.sortQuery="".concat(h.toLowerCase(),",").concat(d.toLowerCase())),c.sort=this.state.sortQuery,this.setSortCache())),t.next=6,this.evt.emit("onBeforeLoad",void 0);case 6:return Object.assign(c,n({},this.state.searchParams)),e&&Object.assign(c,e),t.abrupt("return",c);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return E.apply(this,arguments)})},{key:"switchShowMode",value:(C=y(f().mark((function t(e){var r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.showMode)){t.next=6;break}return"tree"===r?this.state.showTreeGrid=!0:"grid"===r&&(this.state.showTreeGrid=!1),this.state.treeData=h(this.state.items),t.next=6,this.refresh();case 6:case"end":return t.stop()}}),t,this)}))),function(t){return C.apply(this,arguments)})},{key:"onCreated",value:(m=y(f().mark((function t(){var e,r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(l(R.prototype),"onCreated",this).call(this);case 2:e=this.model.controlParam.ctrlParams,(r=void 0===e?{}:e).DEFAULTEXPANDALL&&(this.defaultExpandAll=Object.is(r.DEFAULTEXPANDALL,"TRUE")||Object.is(r.DEFAULTEXPANDALL,"true")),r.GRIDROWACTIVEMODE&&(this.state.mdctrlActiveMode=JSON.parse(r.GRIDROWACTIVEMODE)),r.EXPANDCOLUMNINDEX&&(this.expandColumnIndex=r.EXPANDCOLUMNINDEX);case 6:case"end":return t.stop()}}),t,this)}))),function(){return m.apply(this,arguments)})},{key:"refresh",value:(p=y(f().mark((function t(){var e,r=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.length>0&&void 0!==r[0]&&r[0],t.next=3,this.load({isInitialLoad:e});case 3:case"end":return t.stop()}}),t,this)}))),function(){return p.apply(this,arguments)})},{key:"load",value:(d=y(f().mark((function t(){var e,r,n,o,a,i,s,c,u,l=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=l.length>0&&void 0!==l[0]?l[0]:{},!this.state.isSimple){t.next=3;break}return t.abrupt("return",[]);case 3:if(r=!0===e.silent){t.next=7;break}return t.next=7,this.startLoading();case 7:return t.prev=7,n=!0===e.isInitialLoad,o=!0===e.isLoadMore,n?this.state.curPage=1:o&&(this.state.curPage+=1),a=this.handlerAbilityParams(e),i=a.context,t.next=14,this.getFetchParams(null==e?void 0:e.viewParam);case 14:return null!=(s=t.sent)&&s.hasOwnProperty("srfshowmode")||this.state.showTreeGrid&&Object.assign(s,{srfshowmode:"tree"}),t.next=18,this.service.fetch(i,s);case 18:return"number"==typeof(c=t.sent).total&&(this.state.total=c.total),"number"==typeof c.totalPages&&(this.state.totalPages=c.totalPages),o?(u=this.state.items).push.apply(u,h(c.data)):this.state.items=c.data,t.next=24,this.afterLoad(e,c.data);case 24:return this.state.isLoaded=!0,t.next=27,this.evt.emit("onLoadSuccess",{isInitialLoad:n});case 27:t.next=35;break;case 29:return t.prev=29,t.t0=t.catch(7),t.next=33,this.evt.emit("onLoadError",void 0);case 33:throw this.actionNotification("FETCHERROR",{error:t.t0}),t.t0;case 35:if(t.prev=35,r){t.next=39;break}return t.next=39,this.endLoading();case 39:return t.finish(35);case 40:return this.state.items.forEach((function(t,e){t.srfserialnum=e+1})),this.actionNotification("FETCHSUCCESS"),t.abrupt("return",this.state.items);case 43:case"end":return t.stop()}}),t,this,[[7,29,35,40]])}))),function(){return d.apply(this,arguments)})},{key:"afterLoad",value:(u=y(f().mark((function t(e,r){var n,a=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(l(R.prototype),"afterLoad",this).call(this,e,r);case 2:return!0===e.isInitialLoad?this.state.selectedData=[]:(n=this.state.selectedData.filter((function(t){return a.state.items.find((function(e){return t.tempsrfkey===e.tempsrfkey}))})),this.state.selectedData=n),this.setTreeData(),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)}))),function(t,e){return u.apply(this,arguments)})},{key:"setTreeData",value:function(){var t=this;if(this.state.showTreeGrid){var e=this.state.items.map((function(e){return e[t.treeGridValueField]})).filter((function(t){return void 0!==t})),r=this.state.items.filter((function(r){return!e.includes(r[t.treeGridParentField])}));!function e(r){r.forEach((function(r){var n=t.state.items.filter((function(e){return r[t.treeGridValueField]&&e[t.treeGridParentField]===r[t.treeGridValueField]}));n.length>0&&e(n),r._children=n}))}(r),this.state.treeData=r}}},{key:"save",value:(i=y(f().mark((function t(e){var r,n,o,a,i,s;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.isSimple){t.next=2;break}return t.abrupt("return");case 2:if(r=e.srfuf===v.CREATE,n=this.findRowState(e)){t.next=6;break}throw new H("行数据不存在");case 6:if(n.modified){t.next=9;break}return ibiz.log.debug("值没有发生改变"),t.abrupt("return");case 9:if(!n.processing){t.next=13;break}return t.next=12,X(500,this.save.bind(this),[e]);case 12:return t.abrupt("return");case 13:return t.next=15,this.validate(n);case 15:if(t.sent){t.next=18;break}throw new H("行数据校验不通过，保存取消");case 18:if(a=S(this.model.appDataEntityId),(i=this.context.clone())[a]=e.srfkey,t.prev=21,!r){t.next=28;break}return t.next=25,this.service.create(i,e);case 25:t.t0=t.sent,t.next=31;break;case 28:return t.next=30,this.service.update(i,e);case 30:t.t0=t.sent;case 31:o=t.t0,t.next=43;break;case 34:if(t.prev=34,t.t1=t.catch(21),!r){t.next=39;break}return t.next=39,this.remove({data:[e],silent:!0});case 39:return t.next=41,this.evt.emit("onSaveError",void 0);case 41:throw this.actionNotification("".concat(r?"CREATE":"UPDATE","ERROR"),{error:t.t1,data:n.data}),t.t1;case 43:return s=this.findRowStateIndex(e),this.state.items.splice(s,1,o.data),n.data=o.data,n.modified=!1,this.setTreeData(),this.gridStateNotify(n,k.SAVE),t.next=51,this.evt.emit("onSaveSuccess",void 0);case 51:case"end":return t.stop()}}),t,this,[[21,34]])}))),function(t){return i.apply(this,arguments)})},{key:"afterRemove",value:function(t){var e=this,r=this.state.items.findIndex((function(e){return e.srfkey===t.srfkey}));-1!==r&&this.state.items.splice(r,1);var n=this.findRowStateIndex(t);this.state.rows[n],this.state.rows.splice(n,1),this.state.groups.forEach((function(e){if(e.children.length){var r=e.children.findIndex((function(e){return e.srfkey===t.srfkey}));-1!==r&&e.children.splice(r,1)}})),this.setTreeData();var o=this.state.rows.find((function(r){return t[e.treeGridParentField]&&r.data[e.treeGridValueField]===t[e.treeGridParentField]}));o&&0===o.data._children.length&&this.evt.emit("onRowCollapse",{row:o,state:!1})}},{key:"newRow",value:(r=y(f().mark((function t(){var e,r,o,a,i,s,c,u,l,d=this,h=arguments;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=(h.length>0&&void 0!==h[0]?h[0]:{}).data,r=ibiz.config.grid.editShowMode,o={},e&&(o=Array.isArray(e)?e[0]:e),"row"!==r){t.next=9;break}if(!this.state.rows.find((function(t){return t.showRowEdit}))){t.next=9;break}throw new H("请先完成当前行编辑中的行的操作");case 9:return a=n({},this.params),i=this.calcDefaultValue(o||{},!0),o.srfDefaultData&&Object.assign(i,o.srfDefaultData),Object.assign(a,i),t.prev=13,t.next=16,this.service.getDraft(this.context,a);case 16:s=t.sent,t.next=23;break;case 19:throw t.prev=19,t.t0=t.catch(13),this.actionNotification("GETDRAFTERROR",{error:t.t0}),t.t0;case 23:c=s.data,q(c,i),c[this.treeGridParentField]=o[this.treeGridValueField],o.srfUserData&&(c.srfUserData=o.srfUserData),this.state.items.push(c),u=new g(c,this),this.state.rows.push(u),this.gridStateNotify(u,k.DRAFT),"row"===r&&this.switchRowEdit(u,!0),this.setTreeData(),(l=this.state.rows.find((function(t){return u.data[d.treeGridParentField]&&t.data[d.treeGridValueField]===u.data[d.treeGridParentField]})))&&this.evt.emit("onRowCollapse",{row:l,state:!0}),this.actionNotification("GETDRAFTSUCCESS",{data:c});case 36:case"end":return t.stop()}}),t,this,[[13,19]])}))),function(){return r.apply(this,arguments)})},{key:"onRowClick",value:(e=y(f().mark((function t(e){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.singleSelect&&this.setSelection([e]),1!==this.state.mdctrlActiveMode){t.next=4;break}return t.next=4,this.setActive(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})}]),R}(E),K=function(t){a(p,t);var e,r,i,u,d,h=s(p);function p(){var t;b(this,p);for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];return x(c(t=h.call.apply(h,[this].concat(r))),"codeListItems",void 0),x(c(t),"defaultExpandAll",!1),t}return w(p,[{key:"onCreated",value:(d=y(f().mark((function t(){var e,r;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(l(p.prototype),"onCreated",this).call(this);case 2:e=this.model.controlParam.ctrlParams,(r=void 0===e?{}:e).DEFAULTEXPANDALL&&(this.defaultExpandAll=Object.is(r.DEFAULTEXPANDALL,"TRUE")||Object.is(r.DEFAULTEXPANDALL,"true"));case 4:case"end":return t.stop()}}),t,this)}))),function(){return d.apply(this,arguments)})},{key:"setSort",value:function(t,e){var r;(t||e)&&(t&&(r=this.fieldIdNameMap.get(t).toLowerCase()),this.state.sortQuery=r&&e?"".concat(r,",").concat(e):"",this.setSortCache())}},{key:"setSortCache",value:function(){this.view&&(this.state.sortQuery?localStorage.setItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"),this.state.sortQuery):localStorage.removeItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")))}},{key:"getFetchParams",value:(u=y(f().mark((function t(e){var r,o,a,i,s,c,u,l,d,h;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.state,o=r.curPage,a=r.size,i=r.sortQuery,s=r.noSort,c=n({},this.params),a&&(c.page=o-1,c.size=a),s||(i?c.sort=i:(u=this.getSortModel(),l=u.minorSortAppDEFieldId,d=u.minorSortDir,this.view&&localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort"))?this.state.sortQuery=localStorage.getItem("".concat(this.view.model.id,".").concat(this.model.name,".sort")):l&&d&&(h=this.fieldIdNameMap.get(l),this.state.sortQuery="".concat(h.toLowerCase(),",").concat(d.toLowerCase())),c.sort=this.state.sortQuery,this.setSortCache())),t.next=6,this._evt.emit("onBeforeLoad",void 0);case 6:return Object.assign(c,n({},this.state.searchParams)),e&&Object.assign(c,e),t.abrupt("return",c);case 9:case"end":return t.stop()}}),t,this)}))),function(t){return u.apply(this,arguments)})},{key:"initGroup",value:(i=y(f().mark((function t(){var e,r,n,o;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this.model,r=e.groupCodeListId,n=e.groupMode,!e.enableGroup){t.next=9;break}if("CODELIST"!==n){t.next=9;break}if(r){t.next=5;break}throw new $(this.model,"代码表分组模式需要配置代码表");case 5:return o=ibiz.hub.getApp(this.context.srfappid),t.next=8,o.codeList.get(r,this.context,this.params);case 8:this.codeListItems=t.sent;case 9:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"calcGroupData",value:function(t){var e=this,r=this.model,n=r.enableGroup,o=r.groupMode,a=r.groupAppDEFieldId;if(n&&a){var i=new Map,s="CODELIST"===o,c=a.toLowerCase();s&&this.codeListItems.forEach((function(t){i.set(t.value,[])})),t.forEach((function(t){var e=t[c];s||i.has(e)||i.set(e,[]),i.has(e)&&i.get(e).push(t)})),this.state.groups=[],i.forEach((function(t,r){var n,o=null===(n=e.codeListItems)||void 0===n?void 0:n.find((function(t){return t.value===r}));e.state.groups.push({caption:(null==o?void 0:o.text)||"".concat(r||"其他"),groupIcon:null==o?void 0:o.sysImage,key:r,children:t})}))}}},{key:"afterLoad",value:(r=y(f().mark((function t(e,r){var n,a=this;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,o(l(p.prototype),"afterLoad",this).call(this,e,r);case 2:return!0===e.isInitialLoad?this.state.selectedData=[]:(n=this.state.selectedData.filter((function(t){return a.state.items.find((function(e){return t.tempsrfkey===e.tempsrfkey}))})),this.state.selectedData=n),t.abrupt("return",r);case 5:case"end":return t.stop()}}),t,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"onRowClick",value:(e=y(f().mark((function t(e){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.state.singleSelect&&this.setSelection([e]),1!==this.state.mdctrlActiveMode){t.next=4;break}return t.next=4,this.setActive(e);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})}]),p}(D);function Z(t,e){var r,o={};return null===(r=t.controlAttributes)||void 0===r||r.forEach((function(t){t.attrName&&t.attrValue&&(o[t.attrName]=R.execSingleLine(t.attrValue,n({},e)))})),o}function tt(t,e,r,o){if("GROUPGRIDCOLUMN"===e.columnType){var a,i,s=(null===(a=e.degridColumns)||void 0===a?void 0:a.filter((function(t){return!t.hideDefault})))||[],c=e.width,u=(null===(i=e.align)||void 0===i?void 0:i.toLowerCase())||"center";return A(N("el-table-column"),{prop:e.codeName,label:e.caption,"min-width":c,align:u},{default:function(){return s.map((function(e,n){return tt(t,e,r,n)}))}})}return function(t,e,r,o){var a,i=e.codeName,s=t.columns[i],c=t.state.columnStates.find((function(t){return t.key===i})),u=r.find((function(e){return t.columns[e.codeName].isAdaptiveColumn})),l=s.isAdaptiveColumn||!u&&o===r.length-1?"min-width":"width",f="default";null!=t&&t.expandColumnIndex&&o<U(null==t?void 0:t.expandColumnIndex)&&(f="");var d=e.width,h=t.model.hideHeader;return t.model.enableCustomized&&!h&&d&&o===r.length-1&&(d+=20),A(N("el-table-column"),M({label:e.caption,prop:i},x({},l,d),{fixed:c.fixed,sortable:!!e.enableSort&&"custom",align:(null===(a=e.align)||void 0===a?void 0:a.toLowerCase())||"center",type:f}),{default:function(r){var a=r.row,c=a;if(a.isGroupData)return 0!==o?null:A("div",{class:"group-column"},[A(N("iBizIcon"),{class:"group-icon",icon:a.groupIcon},null),a.caption]);var u=t.findRowState(c);if(u){var l=N(t.providers[i].component);return B(l,{controller:s,row:u,key:c.tempsrfkey+i,attrs:Z(e,n(n({},t.getEventArgs()),{},{data:u.data}))})}return null}})}(t,e,r,o)}var et=j({name:"IBizNumberGridControl",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object},mdctrlActiveMode:{type:Number,default:void 0},singleSelect:{type:Boolean,default:void 0},rowEditOpen:{type:Boolean,default:void 0},isSimple:{type:Boolean,required:!1},data:{type:Array,required:!1},loadDefault:{type:Boolean,default:!0}},setup:function(t){var r;r="TREEGRID"===t.modelData.controlType?p((function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e(J,r)})):p((function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e(K,r)}));var n=i().zIndex;r.state.zIndex=n.increment();var o=u("control-grid"),a=L((function(){if("TREEGRID"===t.modelData.controlType)return u("control-".concat(r.model.controlType.toLowerCase()))})),s=u("number-grid"),c=function(t){var e=O(),r=O([]),n=L((function(){return t.state.treeData}));function o(){return(o=y(f().mark((function e(r,n,o){var a;return f().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.model.enableGroup||!r.isGroupData){e.next=2;break}return e.abrupt("return");case 2:if(r.srfuf!==v.CREATE){e.next=4;break}return e.abrupt("return");case 4:if("row"!==ibiz.config.grid.editShowMode||!t.model.enableRowEdit){e.next=11;break}if(!(a=t.findRowState(r))||!0===a.showRowEdit){e.next=9;break}return e.next=9,t.switchRowEdit(a,!0);case 9:e.next=12;break;case 11:t.onRowClick(r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function a(){return t.model.enableGroup?r.value.filter((function(t){return!t.isGroupData})):h(r.value)}return I([function(){return e.value},function(){return t.state.isLoaded},function(){return t.state.selectedData}],(function(n){var o=d(n,3),i=o[0],s=o[1],c=o[2];s&&i&&(V(c,a())||(r.value=c),t.state.singleSelect&&(c[0]?e.value.setCurrentRow(c[0],!0):e.value.setCurrentRow()))})),I((function(){return t.state.sortQuery}),(function(r){if(r){var n=t.state.sortQuery.split(",")[0],o=t.state.sortQuery.split(",")[1];if(n&&o){var a="desc"===o?"descending":"ascending";!function t(){e.value?G((function(){e.value.sort(n,a)})):setTimeout(t,500)}()}}})),t.evt.on("onRowCollapse",(function(t){setTimeout((function(){e.value&&e.value.toggleRowExpansion(t.row.data,t.state)}),0)})),{tableRef:e,getSelection:a,curSelectedData:r,onRowClick:function(t,e,r){return o.apply(this,arguments)},onDbRowClick:function(e){t.model.enableGroup&&e.isGroupData||e.srfuf!==v.CREATE&&t.onDbRowClick(e)},isSelected:function(t){return!!r.value.find((function(e){return t.tempsrfkey===e.tempsrfkey}))},onSortChange:function(e){var r,n=e.prop,o=e.order,a=t.fieldColumns[n].model.appDEFieldId;"ascending"===o?r="asc":"descending"===o&&(r="desc"),"".concat(a,",").concat(r)!==t.state.sortQuery&&(t.setSort(a,r),t.load())},treeGirdData:n,handleRowClassName:function(e){var n=e.row,o="";r.value.length>0&&r.value.forEach((function(t){t.tempsrfkey===n.tempsrfkey&&(o="current-row")}));var a=t.findRowState(n);return null!=a&&a.showRowEdit&&(o+=" editing-row"),n.srfkey&&(o+=" id-".concat(n.srfkey)),o},handleHeaderCellClassName:function(e){e._row;var r,n=e.column,o=(e._rowIndex,e._columnIndex,null===(r=t.model.degridColumns)||void 0===r?void 0:r.find((function(t){return t.codeName===n.property})));return o&&o.headerSysCss&&o.headerSysCss.cssName?o.headerSysCss.cssName:""}}}(r),l=c.tableRef,m=c.onRowClick,w=c.onDbRowClick,b=c.onSortChange,E=c.isSelected,S=c.curSelectedData,k=c.getSelection,D=c.handleRowClassName,R=c.treeGirdData,P=c.handleHeaderCellClassName,j=function(t){return{onPageChange:function(e){e&&e!==t.state.curPage&&(t.state.curPage=e,t.load())},onPageSizeChange:function(e){e&&e!==t.state.size&&(t.state.size=e,1===t.state.curPage&&t.load())},onPageRefresh:function(){t.load()}}}(r),B=j.onPageChange,U=j.onPageRefresh,X=j.onPageSizeChange,q=L((function(){return"TREEGRID"===t.modelData.controlType&&r.state.showTreeGrid})),$=function(){setTimeout((function(){if(l.value){var t=l.value.$el.getElementsByClassName("el-table__row"),e=0;t.forEach((function(t){var n=t.firstChild.getElementsByClassName("ibiz-number-grid__number--caption")[0];"none"!==t.style.display&&n&&(n.innerText="".concat((r.state.curPage-1)*r.state.size+(e+1)),e++)}))}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)};_((function(){var t=r.model,e=t.controlType,n=t.enableGroup;r.evt.on("onLoadSuccess",(function(){("TREEGRID"===e||"GRID"===e&&n)&&$()}))})),I((function(){return q.value}),(function(t,e){t!==e&&(S.value=[],r.setSelection([]))}));var Z=function(){var t=h(R.value),e=function e(n){var o=r.state.items.filter((function(t){return t[r.treeGridParentField]&&n[r.treeGridValueField]===t[r.treeGridParentField]}));o.length>0&&(t.push.apply(t,h(o)),o.forEach((function(t){e(t)})))};return R.value.forEach((function(t){e(t)})),t},tt=function(){var t=[];return q.value?t=Z():(t=h(ot.value),r.model.enableGroup&&ot.value.forEach((function(e){var r;(r=t).push.apply(r,h(e._children))}))),t},et=function(){var t=tt(),e=!1;t.length>0&&(e=0===t.filter((function(t){return!E(t)})).length);return e},rt=function(t,e){var n=r.model,o=n.controlType,a=n.enableGroup,i=t.findIndex((function(t){return t.tempsrfkey===e.tempsrfkey}));-1!==i?(t.splice(i,1),"GRID"===o&&a&&(Q(e._children)?e._children.forEach((function(e){var r=t.indexOf(e);-1!==r&&t.splice(r,1)})):ot.value.forEach((function(e){var r=e._children.find((function(e){return!t.includes(e)})),n=t.findIndex((function(t){return t.tempsrfkey===e.tempsrfkey}));r&&-1!==n&&t.splice(n,1)})))):(t.push(e),"GRID"===o&&a&&(Q(e._children)?e._children.forEach((function(e){-1===t.indexOf(e)&&t.push(e)})):ot.value.forEach((function(e){var r=e._children.find((function(e){return!t.includes(e)})),n=t.findIndex((function(t){return t.tempsrfkey===e.tempsrfkey}));r||-1!==n||t.unshift(e)}))))},nt=function(t,e){var r=e.modelData.controlParam,n=function(){e.data&&(t.state.items=e.data,t.state.rows=e.data.map((function(e){return new g(new C(e),t)})))},o=L((function(){var e,r=Object.values(t.fieldColumns).find((function(e){return e.model.appDEFieldId===t.model.minorSortAppDEFieldId}));return{prop:null==r?void 0:r.model.codeName,order:"desc"===(null===(e=t.model.minorSortDir)||void 0===e?void 0:e.toLowerCase())?"descending":"ascending"}}));t.evt.on("onCreated",y(f().mark((function r(){return f().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e.isSimple&&(n(),t.state.isLoaded=!0);case 1:case"end":return r.stop()}}),r)})))),I((function(){return e.data}),(function(){e.isSimple&&n()}),{deep:!0});var a=L((function(){var e=t.state,n={appId:t.context.srfappid,cssClass:"cube-outline"};if(r&&r.ctrlParams&&r.ctrlParams.GROUPICON&&(n.cssClass=r.ctrlParams.GROUPICON),t.model.enableGroup){var o=[];return e.groups.forEach((function(t){if(t.children.length){t.groupIcon&&(n=t.groupIcon);var e=h(t.children),r=W();o.push({tempsrfkey:r,srfkey:r,isGroupData:!0,caption:t.caption,_children:e,groupIcon:n})}})),o}return e.rows.map((function(t){return t.data}))})),i=L((function(){if(t.isMultistageHeader)return t.model.degridColumns||[];var e=[];return t.state.columnStates.forEach((function(r){var n,o;if(!r.hidden){var a=(null===(n=t.fieldColumns[r.key])||void 0===n?void 0:n.model)||(null===(o=t.uaColumns[r.key])||void 0===o?void 0:o.model);a&&e.push(a)}})),e}));return{tableData:a,renderColumns:i,defaultSort:o,summaryMethod:function(e){return e.columns.map((function(e,r){return 0===r?t.aggTitle:t.state.aggResult[e.property]}))},headerDragend:function(e,r,n){var o=n.property,a=t.columns[o];if(a.isAdaptiveColumn){a.isAdaptiveColumn=!1,a.model.width=e;var s=i.value.findIndex((function(e){return t.columns[e.codeName].isAdaptiveColumn}));t.hasAdaptiveColumn=-1!==s}}}}(r,t),ot=nt.tableData,at=nt.renderColumns,it=nt.defaultSort,st=nt.summaryMethod,ct=nt.headerDragend,ut=function(t,e){var r,n=O(!1),o=O(),a=T({}),i=function(e){if(!t.value)throw new H("找不到表格组件引用");var r=t.value.$el,n=".editing-row";e.data.srfkey&&(n+=".id-".concat(e.data.srfkey));var o=r.querySelector(n);if(!o)throw new H("找不到对应的表格行dom元素");return o},s=function(){var t=y(f().mark((function t(e){var s,c,u,l,d;return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=i(e),r){t.next=3;break}throw new H("拿不到pop组件的实例");case 3:return c=r.$el,t.next=6,Y(s,c,{placement:"bottom"});case 6:u=t.sent,l=u.x,d=u.y,Object.assign(a,{top:"".concat(d,"px"),left:"".concat(l,"px")}),o.value=e,n.value=!0;case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=function(){var t=y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o.value&&e.switchRowEdit(o.value,!1,!0);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),u=function(){var t=y(f().mark((function t(){return f().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o.value&&e.switchRowEdit(o.value,!1,!1);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return e.evt.on("onRowEditChange",(function(t){t.row.showRowEdit?setTimeout((function(){s(t.row)}),0):(o.value=void 0,n.value=!1,Object.assign(a,{top:void 0,left:void 0}))})),{renderPopover:function(){var t=n.value&&e.state.rows[e.state.rows.length-1].showRowEdit;return[A("div",{class:"row-edit-popover__placeholder",style:{display:t?"block":"none"}},null),A(N("iBizRowEditPopover"),{ref:function(t){r=t},style:a,show:n.value,onConfirm:c,onCancel:u},null)]}}}(l,r),lt=ut.renderPopover;return F((function(){n.decrement()})),{c:r,ns:o,ns2:a,ns3:s,tableRef:l,tableData:ot,treeGirdData:R,showTreeGrid:q,renderColumns:at,onDbRowClick:w,onRowClick:m,onExpandChange:function(t,e){$()},onSortChange:b,onPageChange:B,onPageSizeChange:X,onPageRefresh:U,handleRowClassName:D,handleHeaderCellClassName:P,renderNoData:function(){if(r.state.isLoaded){var t,e=null===(t=r.model.controls)||void 0===t?void 0:t.find((function(t){return t.name==="".concat(r.model.name,"_quicktoolbar")}));return e?A(N("iBizToolbarControl"),{modelData:e,context:r.context,params:r.params,class:o.b("quick-toolbar")},null):A(N("iBizNoData"),{text:r.model.emptyText,emptyTextLanguageRes:r.model.emptyTextLanguageRes},null)}return null},summaryMethod:st,headerDragend:ct,renderPopover:lt,defaultSort:it,renderBatchToolBar:function(){var t,e=null===(t=r.model.controls)||void 0===t?void 0:t.find((function(t){return t.name==="".concat(r.model.name,"_batchtoolbar")}));if(e&&!r.state.singleSelect)return A("div",{class:[o.b("batch-toolbar"),s.b("batch-toolbar"),o.is("show",r.state.selectedData.length>0)]},[A("div",{class:o.b("batch-toolbar-content")},[A("div",{class:o.b("batch-toolbar-text")},[z("已选中"),r.state.selectedData.length,z("项")]),A("div",{class:o.b("batch-toolbar-separator")},[z("|")]),A(N("iBizToolbarControl"),{modelData:e,context:r.context,params:r.params,class:o.b("batch-toolbar-items")},null)])])},renderFirstColumn:function(){var t=at.value.length?"width":"min-width";return A(N("el-table-column"),M({"class-name":s.e("first-column")},x({},t,80),{align:"center",fixed:"left",type:"index"}),{header:function(){return A("div",{class:s.e("number")},[r.state.singleSelect?A("span",null,[z("序号")]):A(N("el-checkbox"),{size:"large",indeterminate:r.state.selectedData.length>0&&!et(),modelValue:et(),onChange:function(){return t=tt(),e=S.value.filter((function(e){return!t.find((function(t){return t.tempsrfkey===e.tempsrfkey}))})),et()||e.push.apply(e,h(t)),S.value=e,void r.setSelection(k());var t,e}},null)])},default:function(t){var e=t.row,n=(t.column,t.$index),o=(r.state.curPage-1)*r.state.size+(n+1);return A("div",{class:[s.e("number"),s.is("multiple",!r.state.singleSelect),s.is("single",r.state.singleSelect)],onClick:function(t){return function(t){t.stopPropagation()}(t)}},[A("span",{class:s.em("number","caption")},[o]),!r.state.singleSelect&&A(N("el-checkbox"),{size:"large",class:s.em("number","checkbox"),modelValue:E(e),onChange:function(){return function(t){rt(S.value,t),r.setSelection(k())}(e)}},null)])}})}}},render:function(){var t,e=this;if(this.c.state.isCreated){var r=this.c.state,n=this.c.model,o=n.hideHeader,a=n.enablePagingBar;return A(N("iBizControlBase"),{class:[this.ns.b(),null===(t=this.ns2)||void 0===t?void 0:t.b(),this.ns3.b(),this.ns.is("show-header",!o),this.ns.is("enable-page",a),this.ns.is("enable-group",this.c.model.enableGroup),this.ns.is("single-select",r.singleSelect),this.ns.is("enable-customized",this.c.model.enableCustomized)],controller:this.c},{default:function(){return[A(N("el-table"),{border:!0,ref:"tableRef","row-key":"tempsrfkey",class:e.ns.e("table"),"default-sort":e.defaultSort,"show-header":!o,"show-summary":e.c.enableAgg,"summary-method":e.summaryMethod,"highlight-current-row":r.singleSelect,"row-class-name":e.handleRowClassName,"header-cell-class-name":e.handleHeaderCellClassName,data:e.showTreeGrid?e.treeGirdData:e.tableData,onRowClick:e.onRowClick,onRowDblclick:e.onDbRowClick,onSortChange:e.onSortChange,onExpandChange:e.onExpandChange,onHeaderDragend:e.headerDragend,"tooltip-effect":"light","default-expand-all":e.c.defaultExpandAll,"tree-props":{children:"_children",hasChildren:"_hasChildren"}},{empty:e.renderNoData,default:function(){return[e.renderFirstColumn(),e.renderColumns.map((function(t,r){return tt(e.c,t,e.renderColumns,r)}))]},append:function(){return e.renderPopover()}}),a&&A(N("iBizPagination"),{total:r.total,curPage:r.curPage,size:r.size,totalPages:r.totalPages,onChange:e.onPageChange,onPageSizeChange:e.onPageSizeChange,onPageRefresh:e.onPageRefresh},null),e.c.model.enableCustomized&&!o&&A("div",{class:[e.ns.b("setting-box"),e.ns3.b("setting-box")]},[A(N("iBizGridSetting"),{columnStates:r.columnStates,controller:e.c},null)]),e.renderBatchToolBar()]}})}}}),rt=t("IBizNumberGridControl",m(et,(function(t){t.component(et.name,et),P("GRID_RENDER_NUMBER_GRID",(function(){return new r}))})));t("default",{install:function(t){t.use(rt)}})}}}))}();
