!function(){function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,n,r){return t=d()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&u(o,n.prototype),o},t.apply(null,arguments)}function n(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function r(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var o=r.call(t,n||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(t)}(t,"string");return"symbol"===e(n)?n:String(n)}function l(){return l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},l.apply(this,arguments)}function u(e,t){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},u(e,t)}function f(t){var n=d();return function(){var r,o=p(t);if(n){var a=p(this).constructor;r=Reflect.construct(o,arguments,a)}else r=o.apply(this,arguments);return function(t,n){if(n&&("object"===e(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(t)}(this,r)}}function d(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function h(e){return function(e){if(Array.isArray(e))return g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||y(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */m=function(){return n};var t,n={},r=Object.prototype,o=r.hasOwnProperty,a=Object.defineProperty||function(e,t,n){e[t]=n.value},i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(t){u=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof b?t:b,i=Object.create(o.prototype),s=new T(r||[]);return a(i,"_invoke",{value:R(e,n,s)}),i}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=f;var p="suspendedStart",h="suspendedYield",v="executing",y="completed",g={};function b(){}function w(){}function C(){}var _={};u(_,s,(function(){return this}));var S=Object.getPrototypeOf,x=S&&S(S(D([])));x&&x!==r&&o.call(x,s)&&(_=x);var O=C.prototype=b.prototype=Object.create(_);function P(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function E(t,n){function r(a,i,s,c){var l=d(t[a],t,i);if("throw"!==l.type){var u=l.arg,f=u.value;return f&&"object"==e(f)&&o.call(f,"__await")?n.resolve(f.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):n.resolve(f).then((function(e){u.value=e,s(u)}),(function(e){return r("throw",e,s,c)}))}c(l.arg)}var i;a(this,"_invoke",{value:function(e,t){function o(){return new n((function(n,o){r(e,t,n,o)}))}return i=i?i.then(o,o):o()}})}function R(e,n,r){var o=p;return function(a,i){if(o===v)throw new Error("Generator is already running");if(o===y){if("throw"===a)throw i;return{value:t,done:!0}}for(r.method=a,r.arg=i;;){var s=r.delegate;if(s){var c=L(s,r);if(c){if(c===g)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===p)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=v;var l=d(e,n,r);if("normal"===l.type){if(o=r.done?y:h,l.arg===g)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(o=y,r.method="throw",r.arg=l.arg)}}}function L(e,n){var r=n.method,o=e.iterator[r];if(o===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,L(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=d(o,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var i=a.arg;return i?i.done?(n[e.resultName]=i.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function k(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function D(n){if(n||""===n){var r=n[s];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,i=function e(){for(;++a<n.length;)if(o.call(n,a))return e.value=n[a],e.done=!1,e;return e.value=t,e.done=!0,e};return i.next=i}}throw new TypeError(e(n)+" is not iterable")}return w.prototype=C,a(O,"constructor",{value:C,configurable:!0}),a(C,"constructor",{value:w,configurable:!0}),w.displayName=u(C,l,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,u(e,l,"GeneratorFunction")),e.prototype=Object.create(O),e},n.awrap=function(e){return{__await:e}},P(E.prototype),u(E.prototype,c,(function(){return this})),n.AsyncIterator=E,n.async=function(e,t,r,o,a){void 0===a&&(a=Promise);var i=new E(f(e,t,r,o),a);return n.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},P(O),u(O,l,"Generator"),u(O,s,(function(){return this})),u(O,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=D,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(k),!e)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,o){return s.type="throw",s.arg=e,n.next=r,o&&(n.method="next",n.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var c=o.call(i,"catchLoc"),l=o.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),k(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),g}},n}function v(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,i,s=[],c=!0,l=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(s.push(r.value),s.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw o}}return s}}(e,t)||y(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){if(e){if("string"==typeof e)return g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?g(e,t):void 0}}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function b(e,t,n,r,o,a,i){try{var s=e[a](i),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,o)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var a=e.apply(t,n);function i(e){b(a,r,o,i,s,"next",e)}function s(e){b(a,r,o,i,s,"throw",e)}i(void 0)}))}}System.register(["@ibiz-template/runtime","vue","@ibiz-template/vue3-util","@ibiz-template/core","qx-util"],(function(e,n){"use strict";var i,c,d,y,g,b,C,_,S,x,O,P,E,R,L,j,k,T,D,N,I,A,G,z,B,F;return{setters:[function(e){i=e.Srfuf,c=e.GridRowState,d=e.ControlVO,y=e.GridController,g=e.ScriptFactory,b=e.registerControlProvider},function(e){C=e.ref,_=e.watch,S=e.computed,x=e.nextTick,O=e.defineComponent,P=e.onMounted,E=e.onBeforeUnmount,R=e.onUnmounted,L=e.createVNode,j=e.resolveComponent,k=e.createTextVNode,T=e.renderSlot,D=e.isVNode,N=e.mergeProps,I=e.h},function(e){A=e.useControlController,G=e.useNamespace,z=e.useUIStore},function(e){B=e.RuntimeModelError},function(e){F=e.createUUID}],execute:function(){var n=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}(c,e);var t,n,r,o,i=f(c);function c(){return a(this,c),i.apply(this,arguments)}return s(c,[{key:"initState",value:function(){l(p(c.prototype),"initState",this).call(this),this.state.baseline="baseline",this.state.compareline="comparison_baseline",this.state.compareGroup=[],this.state.compareList=[]}},{key:"onCreated",value:(o=w(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(p(c.prototype),"onCreated",this).call(this);case 2:return this.controlParams&&(this.controlParams.baseline&&(this.state.baseline=this.controlParams.baseline),this.controlParams.comparison_baseline&&(this.state.compareline=this.controlParams.comparison_baseline)),e.next=5,this.loadCompareSelectData();case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"convertList",value:function(e){if(this.controlParams.responsemap){var t=[],n={id:"id",name:"name"};try{var r=JSON.parse(this.controlParams.responsemap);Object.assign(n,r)}catch(o){console.log("转化JSON配置错误")}e.forEach((function(e){t.push(Object.assign(e,{id:e[n.id],name:e[n.name]}))})),this.state.compareList=t}else this.state.compareList=e}},{key:"loadCompareSelectData",value:(r=w(m().mark((function e(){var t,n,r,o,a;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=g.execScriptFn({context:this.context,params:this.params},this.controlParams.requesturl,{singleRowReturn:!0}),n=g.execScriptFn({context:this.context,params:this.params},this.controlParams.n_owner_id_eq,{singleRowReturn:!0}),r=g.execScriptFn({context:this.context,params:this.params},this.controlParams.n_owner_type_eq,{singleRowReturn:!0}),o={method:this.controlParams.requestmethod||"post",data:{n_owner_id_eq:n,n_owner_type_eq:r}},!t||"string"!=typeof t){e.next=11;break}return e.next=7,ibiz.net.request(t,o);case 7:(a=e.sent)&&a.data&&(Array.isArray(a.data)?this.convertList(a.data):this.convertList([a.data])),e.next=12;break;case 11:throw new B(this.model,"请配置数据接口地址");case 12:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"load",value:(n=w(m().mark((function e(){var t,n,r,o,a,i,s,c,l,u=arguments;return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},!this.state.isSimple){e.next=3;break}return e.abrupt("return",[]);case 3:if(n=!0===t.silent){e.next=7;break}return e.next=7,this.startLoading();case 7:return e.prev=7,r=!0===t.isInitialLoad,o=!0===t.isLoadMore,r?this.state.curPage=1:o&&(this.state.curPage+=1),a=this.handlerAbilityParams(t),i=a.context,e.next=14,this.getFetchParams(null==t?void 0:t.viewParam);case 14:return(s=e.sent)[this.state.compareline]||(s[this.state.compareline]=this.params[this.state.baseline]),e.next=18,this.service.fetch(i,s);case 18:return"number"==typeof(c=e.sent).total&&(this.state.total=c.total),"number"==typeof c.totalPages&&(this.state.totalPages=c.totalPages),o?(l=this.state.items).push.apply(l,h(c.data)):this.state.items=c.data,e.next=24,this.afterLoad(t,c.data);case 24:return this.state.isLoaded=!0,e.next=27,this._evt.emit("onLoadSuccess",{isInitialLoad:r});case 27:e.next=35;break;case 29:return e.prev=29,e.t0=e.catch(7),e.next=33,this._evt.emit("onLoadError",void 0);case 33:throw this.actionNotification("FETCHERROR",{error:e.t0}),e.t0;case 35:if(e.prev=35,n){e.next=39;break}return e.next=39,this.endLoading();case 39:return e.finish(35);case 40:return this.state.items.forEach((function(e,t){e.srfserialnum=t+1})),this.actionNotification("FETCHSUCCESS"),e.abrupt("return",this.state.items);case 43:case"end":return e.stop()}}),e,this,[[7,29,35,40]])}))),function(){return n.apply(this,arguments)})},{key:"afterLoad",value:(t=w(m().mark((function e(t,n){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l(p(c.prototype),"afterLoad",this).call(this,t,n);case 2:return this.computeCompareGroup(t,n),e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"computeCompareGroup",value:function(e,t){var n,r,o=this,a=[],i=[],s=(null==e||null===(n=e.viewParam)||void 0===n?void 0:n[this.state.baseline])||this.params[this.state.baseline],c=(null==e||null===(r=e.viewParam)||void 0===r?void 0:r[this.state.compareline])||this.params[this.state.baseline],l=[],u=[];t.forEach((function(e){s===c?"1"===e.is_latest?u.push(e):l.push(e):e.principal_id===s?l.push(e):u.push(e)})),l.forEach((function(e){var t=o.diffItms(e.target_id,l,u);if("DEL"===t)a.push(Object.assign(e,{actionType:t})),i.push(Object.assign({},{actionType:t,tempsrfkey:F(),base_version:s,compare_version:c,base_target_version_id:e.target_version_id,compare_target_version_id:""}));else{var n=u.findIndex((function(t){return t.target_id===e.target_id}));o.compareField(e,u[n])?(a.push(Object.assign(e,{actionType:t})),i.push(Object.assign(u[n],{actionType:t,base_version:s,compare_version:c,base_target_version_id:e.target_version_id,compare_target_version_id:u[n].target_version_id}))):(a.push(Object.assign(e,{actionType:"UN".concat(t)})),i.push(Object.assign(u[n],{actionType:"UN".concat(t),base_version:s,compare_version:c,base_target_version_id:e.target_version_id,compare_target_version_id:u[n].target_version_id}))),u.splice(n,1)}})),u.forEach((function(e){a.push(Object.assign({},{actionType:"ADD",tempsrfkey:F()})),i.push(Object.assign(e,{actionType:"ADD",base_version:s,compare_version:c}))}));var f=this.state.compareList.find((function(e){return e.id===s})),d=this.state.compareList.find((function(e){return e.id===c}));this.state.compareGroup=[{name:null==f?void 0:f.name,id:null==f?void 0:f.id,data:a},{name:null==d?void 0:d.name,id:null==d?void 0:d.id,data:i}]}},{key:"compareField",value:function(e,t){return e.target_version_id!==t.target_version_id}},{key:"diffItms",value:function(e,t,n){var r=t.filter((function(t){return t.target_id===e})),o=n.filter((function(t){return t.target_id===e}));return r.length>0&&o.length>0?"EDIT":r.length>0?"DEL":void 0}}]),c}(y);function U(e,t){var n,o={};return null===(n=e.controlAttributes)||void 0===n||n.forEach((function(e){e.attrName&&e.attrValue&&(o[e.attrName]=g.execSingleLine(e.attrValue,r({},t)))})),o}function M(e,t,n,a){if("GROUPGRIDCOLUMN"===t.columnType){var i,s,c=(null===(i=t.degridColumns)||void 0===i?void 0:i.filter((function(e){return!e.hideDefault&&!e.hiddenDataItem})))||[],l=t.width,u=(null===(s=t.align)||void 0===s?void 0:s.toLowerCase())||"center";return L(j("el-table-column"),{prop:t.codeName,label:t.caption,"min-width":l,align:u},{default:function(){return c.map((function(t,r){return M(e,t,n,r)}))}})}return function(e,t,n,a){var i,s=t.codeName,c=t.width,l=e.columns[s],u=e.state.columnStates.find((function(e){return e.key===s})),f=l.isAdaptiveColumn||!e.hasAdaptiveColumn&&a===n.length-1?"min-width":"width";return L(j("el-table-column"),N({label:t.caption,prop:s},o({},f,c),{fixed:u.fixed,sortable:!!t.enableSort&&"custom",align:(null===(i=t.align)||void 0===i?void 0:i.toLowerCase())||"center"}),{default:function(n){var o=n.row,a=o;o.isGroupData&&(a=o.first);var i=e.findRowState(a);if("UAGRIDCOLUMN"===t.columnType&&!["EDIT","UNEDIT"].includes(a.actionType))return null;if(i){var c=j(e.providers[s].component);return I(c,{controller:l,row:i,key:a.tempsrfkey+s,attrs:U(t,r(r({},e.getEventArgs()),{},{data:i.data}))})}return null}})}(e,t,n,a)}var q=O({name:"BaselineCompare",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object},mdctrlActiveMode:{type:Number,default:void 0},singleSelect:{type:Boolean,default:void 0},rowEditOpen:{type:Boolean,default:void 0},isSimple:{type:Boolean,required:!1},data:{type:Array,required:!1},loadDefault:{type:Boolean,default:!0}},setup:function(e,r){var a=r.slots,s=A((function(){for(var e=arguments.length,r=new Array(e),o=0;o<e;o++)r[o]=arguments[o];return t(n,r)})),l=G("baseline-compare"),u=z().zIndex;s.state.zIndex=u.increment();var f=C(),p=C(),y=C(),g=C(),b=C([]);s.params[s.state.compareline]&&(y.value=s.params[s.state.compareline]),s.params[s.state.baseline]&&(g.value=s.params[s.state.baseline]);var O=function(e){var t=C(),n=!1,r=!1;function o(){return(o=w(m().mark((function t(n,r,o){var a;return m().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.srfuf!==i.CREATE){t.next=2;break}return t.abrupt("return");case 2:if("row"!==ibiz.config.grid.editShowMode||!e.model.enableRowEdit){t.next=9;break}if(!(a=e.findRowState(n))||!0===a.showRowEdit){t.next=7;break}return t.next=7,e.switchRowEdit(a,!0);case 7:t.next=10;break;case 9:e.onRowClick(n);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return _([function(){return t.value},function(){return e.state.isLoaded},function(){return e.state.selectedData}],(function(r){var o=v(r,3),a=o[0],i=o[1],s=o[2];i&&a&&(e.state.singleSelect?s[0]?t.value.setCurrentRow(s[0],!0):t.value.setCurrentRow():(n=!0,t.value.clearSelection(),s.forEach((function(e){return t.value.toggleRowSelection(e,!0)})),n=!1))})),_((function(){return e.state.sortQuery}),(function(n){if(n){var o=e.state.sortQuery.split(",")[0],a=e.state.sortQuery.split(",")[1];if(o&&a){var i="desc"===a?"descending":"ascending";!function e(){t.value?x((function(){r=!0,t.value.sort(o,i)})):setTimeout(e,500)}()}}})),{tableRef:t,onRowClick:function(e,t,n){return o.apply(this,arguments)},onDbRowClick:function(t){t.srfuf!==i.CREATE&&e.onDbRowClick(t)},onSelectionChange:function(t){n||e.setSelection(t)},onSortChange:function(t){if(r)r=!1;else{var n,o=t.prop,a=t.order,i=e.fieldColumns[o].model.appDEFieldId;"ascending"===a?n="asc":"descending"===a&&(n="desc"),"".concat(i,",").concat(n)!==e.state.sortQuery&&(e.setSort(i,n),e.load())}},handleRowClassName:function(t){var n=t.row,r="";e.state.selectedData.length>0&&e.state.selectedData.forEach((function(e){e===n&&(r="current-row")}));var o=e.findRowState(n);return null!=o&&o.showRowEdit&&(r+=" editing-row"),n.srfkey&&(r+=" id-".concat(n.srfkey)),e.enableRowEditOrder&&(r+=" enable-order"),r},handleHeaderCellClassName:function(t){t._row;var n,r=t.column,o=(t._rowIndex,t._columnIndex,null===(n=e.model.degridColumns)||void 0===n?void 0:n.find((function(e){return e.codeName===r.property})));return o&&o.headerSysCss&&o.headerSysCss.cssName?o.headerSysCss.cssName:""}}}(s),N=O.onRowClick,I=O.onDbRowClick,B=O.onSelectionChange,F=O.onSortChange,U=O.handleRowClassName,q=O.handleHeaderCellClassName,H=function(e){return{onPageChange:function(t){t&&t!==e.state.curPage&&(e.state.curPage=t,e.load())},onPageSizeChange:function(t){t&&t!==e.state.size&&(e.state.size=t,1===e.state.curPage&&e.load())},onPageRefresh:function(){e.load()}}}(s),V=H.onPageChange,$=H.onPageRefresh,Q=H.onPageSizeChange,W=function(e,t){var n=function(){t.data&&(e.state.items=t.data,e.state.rows=t.data.map((function(t){return new c(new d(t),e)})))},r=S((function(){var t,n=Object.values(e.fieldColumns).find((function(t){return t.model.appDEFieldId===e.model.minorSortAppDEFieldId}));return{prop:null==n?void 0:n.model.codeName,order:"desc"===(null===(t=e.model.minorSortDir)||void 0===t?void 0:t.toLowerCase())?"descending":"ascending"}}));return e.evt.on("onCreated",w(m().mark((function r(){return m().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.isSimple&&(n(),e.state.isLoaded=!0);case 1:case"end":return r.stop()}}),r)})))),_((function(){return t.data}),(function(){t.isSimple&&n()}),{deep:!0}),{tableData:S((function(){var t=e.state;if(e.model.enableGroup){var n=[];return t.groups.forEach((function(e){if(e.children.length){var t=h(e.children),r=t.shift();n.push({tempsrfkey:(null==r?void 0:r.tempsrfkey)||e.caption,srfkey:(null==r?void 0:r.srfkey)||e.caption,isGroupData:!0,caption:e.caption,first:r,children:t})}})),n}return t.rows.map((function(e){return e.data}))})),renderColumns:S((function(){if(e.isMultistageHeader)return e.model.degridColumns||[];var t=[];return e.state.columnStates.forEach((function(n){var r,o;if(!n.hidden){var a=(null===(r=e.fieldColumns[n.key])||void 0===r?void 0:r.model)||(null===(o=e.uaColumns[n.key])||void 0===o?void 0:o.model);a&&t.push(a)}})),t})),defaultSort:r,summaryMethod:function(t){return t.columns.map((function(t,n){return 0===n?e.aggTitle:e.state.aggResult[t.property]}))}}}(s,e),J=W.tableData,Y=W.renderColumns,K=W.defaultSort,X=W.summaryMethod,Z=function(e){g.value&&e&&s.load({isInitialLoad:!0,viewParam:o(o({},s.state.baseline,g.value),s.state.compareline,e)})},ee=function(e){if(e){var t,n=null===(t=e.target)||void 0===t?void 0:t.scrollTop;f.value.setScrollTop(n),p.value.setScrollTop(n)}},te=function(e){e&&e.addEventListener("scroll",ee)};P(w(m().mark((function e(){return m().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:setTimeout((function(){var e,t,n=null===(e=f.value)||void 0===e||null===(e=e.$refs.bodyWrapper.getElementsByClassName("el-scrollbar__wrap"))||void 0===e?void 0:e[0],r=null===(t=p.value)||void 0===t||null===(t=t.$refs.bodyWrapper.getElementsByClassName("el-scrollbar__wrap"))||void 0===t?void 0:t[0];te(n),te(r)}),1200);case 1:case"end":return e.stop()}}),e)})))),_((function(){return s.state.compareList}),(function(e){e&&!y.value&&(y.value=g.value),g.value&&y.value&&e.length>0&&s.load({isInitialLoad:!0,viewParam:o(o({},s.state.baseline,g.value),s.state.compareline,y.value)})}),{immediate:!0,deep:!0});return E((function(){var e,t,n=null===(e=f.value)||void 0===e||null===(e=e.$refs.bodyWrapper.getElementsByClassName("el-scrollbar__wrap"))||void 0===e?void 0:e[0],r=null===(t=p.value)||void 0===t||null===(t=t.$refs.bodyWrapper.getElementsByClassName("el-scrollbar__wrap"))||void 0===t?void 0:t[0];n&&n.removeEventListener("scroll",ee),r&&r.removeEventListener("scroll",ee)})),R((function(){u.decrement()})),{c:s,ns:l,curTableRef:f,compareTableRef:p,tableData:J,renderColumns:Y,CustomCellClass:function(e){return e.column&&"index"===e.column.type?"baseline-index":e.column&&"uagridcolumn1"===e.column.property?"baseline-uaaction":void 0},renderTableColumn:function(e,t,n){return 0===n&&"UAGRIDCOLUMN"===e.columnType?null:a[e.id]?T(a,e.id,{model:e,data:s.state.items}):M(s,e,Y.value,t)},onDbRowClick:I,onRowClick:N,onSelectionChange:B,onSortChange:F,onPageChange:V,onPageSizeChange:Q,onPageRefresh:$,handleRowClassName:U,handleHeaderCellClassName:q,renderNoData:function(){return s.state.isLoaded?L(j("iBizNoData"),{text:s.model.emptyText,emptyTextLanguageRes:s.model.emptyTextLanguageRes},null):L("div",null,null)},summaryMethod:X,customHeaderRowClass:function(e){var t=q({_row:e.row,_columnIndex:e._columnIndex,_rowIndex:e.rowIndex,column:e.column});return e.column&&"index"===e.column.type?"".concat(t," baseline-header baseline-index"):"".concat(t," baseline-header")},renderSelectCompare:function(){var e,t;return L(j("el-select"),{modelValue:y.value,"onUpdate:modelValue":function(e){return y.value=e},"fit-input-width":!0,onChange:Z},"function"==typeof(t=e=s.state.compareList.map((function(e){return L(j("el-option"),{value:e.id,label:e.name},{default:function(){return[L("div",{class:l.e("dropdown-select")},[L("span",null,[e.name]),e.id===g.value?L("div",{class:l.em("dropdown-select","last")},[k("最新版本")]):null])]}})})))||"[object Object]"===Object.prototype.toString.call(t)&&!D(t)?e:{default:function(){return[e]}})},renderLegendIcon:function(){return L("div",{class:l.e("legen-icon")},[L("div",{class:l.em("legen-icon","add")},[k("新增")]),L("div",{class:l.em("legen-icon","change")},[k("修改")]),L("div",{class:l.em("legen-icon","del")},[k("删除")])])},customRowClass:function(e){var t=U({row:e.row});if(e.row&&e.row.actionType){var n="compareline-type-".concat(e.row.actionType.toLowerCase());return"".concat(t," ").concat(n)}return t},compareGroup:b,defaultSort:K}},render:function(){var e=this;if(this.c.state.isCreated){var t=this.c.state,n=this.c.model,r=n.hideHeader,o=n.enablePagingBar;return L(j("iBizControlBase"),{class:[this.ns.is("show-header",!r),this.ns.is("enable-page",o),this.ns.is("enable-group",this.c.model.enableGroup),this.ns.is("single-select",t.singleSelect),this.ns.is("empty",0===t.items.length),this.ns.is("enable-customized",this.c.model.enableCustomized)],controller:this.c},{default:function(){return[L("div",{class:[e.ns.b(),e.ns.is("show-page",o)]},[L("div",{class:e.ns.e("select")},[L("div",{class:e.ns.em("select","title")},[e.c.view.model.caption]),L("div",{class:e.ns.em("select","right")},[e.renderSelectCompare(),L("span",{class:e.ns.em("select","separate")},[k("|")]),e.renderLegendIcon()])]),L("div",{class:e.ns.e("grid")},[t.compareGroup.map((function(n,o){return L("div",{class:[e.ns.em("grid",n.id),e.ns.e("version")]},[L("div",{class:e.ns.em("version","title")},[n.name]),L("div",{class:e.ns.em("version","compare-grid")},[L(j("el-table"),{ref:0===o?"curTableRef":"compareTableRef",class:e.ns.e("table"),"default-sort":e.defaultSort,border:!0,"show-header":!r,"show-summary":e.c.enableAgg,"summary-method":e.summaryMethod,"highlight-current-row":t.singleSelect,"cell-class-name":e.CustomCellClass,"row-class-name":e.customRowClass,"header-cell-class-name":e.customHeaderRowClass,"row-key":"tempsrfkey",data:n.data,onRowClick:e.onRowClick,onRowDblclick:e.onDbRowClick,onSelectionChange:e.onSelectionChange,onSortChange:e.onSortChange,"tooltip-effect":"light"},{empty:e.renderNoData,default:function(){return[0===o&&L(j("el-table-column"),{"class-name":e.ns.e("row-index"),label:"#",type:"index",align:"center",width:"55"},null),e.renderColumns.map((function(t,n){return e.renderTableColumn(t,n,o)}))]}}),e.c.model.enableCustomized&&!r&&1===o&&L("div",{class:e.ns.b("setting-box")},[L(j("iBizGridSetting"),{columnStates:t.columnStates,controller:e.c},null)])])])}))])]),o&&L(j("iBizPagination"),{total:t.total,curPage:t.curPage,size:t.size,totalPages:t.totalPages,onChange:e.onPageChange,onPageSizeChange:e.onPageSizeChange,onPageRefresh:e.onPageRefresh},null)]}})}}}),H=s((function e(){a(this,e),o(this,"component","BaselineCompare")}));e("default",{install:function(e){e.component(q.name,q),b("GRID_RENDER_BASELINECOMPARE",(function(){return new H}))}})}}}))}();
