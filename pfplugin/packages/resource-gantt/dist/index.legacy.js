!function(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,n,r){return e=y()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var a=new(Function.bind.apply(t,r));return n&&h(a,n.prototype),a},e.apply(null,arguments)}function n(){return n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=g(t)););return t}(t,e);if(r){var a=Object.getOwnPropertyDescriptor(r,e);return a.get?a.get.call(arguments.length<3?t:n):a.value}},n.apply(this,arguments)}function r(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */r=function(){return n};var e,n={},a=Object.prototype,o=a.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},l="function"==typeof Symbol?Symbol:{},u=l.iterator||"@@iterator",s=l.asyncIterator||"@@asyncIterator",c=l.toStringTag||"@@toStringTag";function d(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{d({},"")}catch(e){d=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var a=e&&e.prototype instanceof b?e:b,o=Object.create(a.prototype),l=new N(r||[]);return i(o,"_invoke",{value:S(t,n,l)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}n.wrap=f;var h="suspendedStart",v="suspendedYield",m="executing",y="completed",g={};function b(){}function w(){}function x(){}var D={};d(D,u,(function(){return this}));var C=Object.getPrototypeOf,_=C&&C(C(R([])));_&&_!==a&&o.call(_,u)&&(D=_);var k=x.prototype=b.prototype=Object.create(D);function I(t){["next","throw","return"].forEach((function(e){d(t,e,(function(t){return this._invoke(e,t)}))}))}function O(e,n){function r(a,i,l,u){var s=p(e[a],e,i);if("throw"!==s.type){var c=s.arg,d=c.value;return d&&"object"==t(d)&&o.call(d,"__await")?n.resolve(d.__await).then((function(t){r("next",t,l,u)}),(function(t){r("throw",t,l,u)})):n.resolve(d).then((function(t){c.value=t,l(c)}),(function(t){return r("throw",t,l,u)}))}u(s.arg)}var a;i(this,"_invoke",{value:function(t,e){function o(){return new n((function(n,a){r(t,e,n,a)}))}return a=a?a.then(o,o):o()}})}function S(t,n,r){var a=h;return function(o,i){if(a===m)throw new Error("Generator is already running");if(a===y){if("throw"===o)throw i;return{value:e,done:!0}}for(r.method=o,r.arg=i;;){var l=r.delegate;if(l){var u=E(l,r);if(u){if(u===g)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(a===h)throw a=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);a=m;var s=p(t,n,r);if("normal"===s.type){if(a=r.done?y:v,s.arg===g)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(a=y,r.method="throw",r.arg=s.arg)}}}function E(t,n){var r=n.method,a=t.iterator[r];if(a===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,E(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var o=p(a,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,g;var i=o.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function L(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function R(n){if(n||""===n){var r=n[u];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var a=-1,i=function t(){for(;++a<n.length;)if(o.call(n,a))return t.value=n[a],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw new TypeError(t(n)+" is not iterable")}return w.prototype=x,i(k,"constructor",{value:x,configurable:!0}),i(x,"constructor",{value:w,configurable:!0}),w.displayName=d(x,c,"GeneratorFunction"),n.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},n.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,x):(t.__proto__=x,d(t,c,"GeneratorFunction")),t.prototype=Object.create(k),t},n.awrap=function(t){return{__await:t}},I(O.prototype),d(O.prototype,s,(function(){return this})),n.AsyncIterator=O,n.async=function(t,e,r,a,o){void 0===o&&(o=Promise);var i=new O(f(t,e,r,a),o);return n.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},I(k),d(k,c,"Generator"),d(k,u,(function(){return this})),d(k,"toString",(function(){return"[object Generator]"})),n.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},n.values=R,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var n in this)"t"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,a){return l.type="throw",l.arg=t,n.next=r,a&&(n.method="next",n.arg=e),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],l=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=o.call(i,"catchLoc"),s=o.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,g):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),L(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var a=r.arg;L(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},n}function a(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?a(Object(n),!0).forEach((function(e){i(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function i(t,e,n){return(e=f(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n,r,a,o,i){try{var l=t[o](i),u=l.value}catch(s){return void n(s)}l.done?e(u):Promise.resolve(u).then(r,a)}function u(t){return function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(t){l(o,r,a,i,u,"next",t)}function u(t){l(o,r,a,i,u,"throw",t)}i(void 0)}))}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,f(r.key),r)}}function d(t,e,n){return e&&c(t.prototype,e),n&&c(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(e){var n=function(e,n){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var a=r.call(e,n||"default");if("object"!==t(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"===t(n)?n:String(n)}function p(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function v(e){var n=y();return function(){var r,a=g(e);if(n){var o=g(this).constructor;r=Reflect.construct(a,arguments,o)}else r=a.apply(this,arguments);return function(e,n){if(n&&("object"===t(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}(this,r)}}function m(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}function b(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||x(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,o,i,l=[],u=!0,s=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(l.push(r.value),l.length!==e);u=!0);}catch(t){s=!0,a=t}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}(t,e)||x(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){if(t){if("string"==typeof t)return D(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(t,e):void 0}}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}System.register(["@ibiz-template/runtime","@ibiz-template/vue3-util","vue","qx-util","dayjs","lodash-es","@ibiz-template/core","ramda"],(function(t,a){"use strict";var l,c,f,h,y,x,D,C,_,k,I,O,S,E,T,L,N,R,M,A,j,V,P,z,B,G,F,q,Y,W,$,H,U,K,Q,J,Z,X,tt;return{setters:[function(t){l=t.GanttService,c=t.getChildNodeRSs,f=t.getRootNode,h=t.handleAllSettled,y=t.getTreeNode,x=t.GanttDataSetNodeData,D=t.GanttController,C=t.calcDeCodeNameById,_=t.Srfuf,k=t.TreeGridExNotifyState,I=t.isValueChange,O=t.TreeGridExRowState,S=t.TreeGridExFieldColumnController,E=t.registerPanelItemProvider,T=t.registerControlProvider},function(t){L=t.useNamespace,N=t.PanelRawItemController,R=t.withInstall,M=t.useControlController},function(t){A=t.defineComponent,j=t.createVNode,V=t.ref,P=t.computed,z=t.onMounted,B=t.createTextVNode,G=t.resolveComponent,F=t.watch,q=t.isVNode,Y=t.getCurrentInstance,W=t.withDirectives,$=t.resolveDirective,H=t.h},function(t){U=t.createUUID},function(t){K=t.default},function(t){Q=t.isObject},function(t){J=t.ModelError,Z=t.RuntimeError,X=t.awaitTimeout},function(t){tt=t.isNotNil}],execute:function(){var et=function(t){var e=new Date(t),n=K(e),r=K();return n.isSame(r,"day")},nt=function(t,e){return t.replace(/\${(.*?)}/g,(function(t,n){var r=w(n.split("."),2),a=r[0],o=r[1],i=e[a]||"";return Q(i)?i[o]?i[o]:"":i}))},rt=function(t,e){var n=K(t).day();return e.includes(n)},at=function(t,e){var n=[],r=0,a=nt(e,t.data&&t.data._deData?t.data._deData:{}),o={};try{o=JSON.parse(a)}catch(i){o={}}return o.weekdays&&(n=o.weekdays.split(",").map((function(t){return Number(t)}))),o.dayCapacityVal&&(r=Number(o.dayCapacityVal)),Object.assign(o,{weekdays:n,dayCapacity:r}),o},ot=function(t,e,n){return(t.isAfter(e)||t.isSame(e))&&(t.isBefore(n)||t.isSame(n))},it=function(t,e){for(var n=Math.floor(t/e*10)/10,r=Math.round(10*(t-n*e))/10,a=new Array(e).fill(n),o=0,i=0;o<r;i++)a[i]=Math.round(10*(a[i]+.1))/10,o=Math.round(10*(o+.1))/10;return a};function lt(t){return t.getBoundingClientRect().top}function ut(t){var e=t.getBoundingClientRect();return(window.innerHeight||document.documentElement.clientHeight)-(e.top+e.height)}var st=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=K(t).startOf("day");return e.filter((function(t){var e=t._beginDataItemValue?K(t._beginDataItemValue).startOf("day"):null,r=t._endDataItemValue?K(t._endDataItemValue).startOf("day"):null;return!(e&&r&&e.isAfter(r))&&(!e&&r&&n.isSame(r,"day")||e&&!r&&n.isSame(e,"day")||e&&r&&function(t,e,n){var r=K(t),a=K(e),o=K(n);if(!(r instanceof K&&a instanceof K&&o instanceof K))throw new Error("All arguments must be dayjs objects");return r.isAfter(a)&&r.isBefore(o)||r.isSame(a)||r.isSame(o)}(n,e,r))})).length},ct=function(t,e,n){for(var r=new Date(t),a=new Date(e),o=[],i=new Date(r);i<=a;i.setDate(i.getDate()+1))rt(i,n)&&o.push(new Date(i));return o},dt=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=0,o=K(e).startOf("day");return n.filter((function(t){return ot(o,K(t._beginDataItemValue).startOf("day"),K(t._endDataItemValue).startOf("day"))})).forEach((function(e){var n=K(e._beginDataItemValue).startOf("day"),i=K(e._endDataItemValue).startOf("day"),l=ct(new Date(n.format("YYYY-MM-DD")),new Date(i.format("YYYY-MM-DD")),t),u=l.length,s=e._deData[r]?Number(e._deData[r]):0;if(u>0&&s>0){var c=it(s,u),d=l.findIndex((function(t){return K(t).startOf("day").isSame(o)})),f=-1!==d?c[d]:0;a=Math.round(10*(a+f))/10}})),a},ft=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=0,o=K(e).startOf("day"),i=K(new Date).startOf("day");return o.isBefore(i)?0:(n.filter((function(t){return ot(o,K(t._beginDataItemValue).startOf("day"),K(t._endDataItemValue).startOf("day"))})).forEach((function(e){var n=K(e._beginDataItemValue).startOf("day"),l=K(e._endDataItemValue).startOf("day");n.isBefore(i)&&(n=i);var u=ct(new Date(n.format("YYYY-MM-DD")),new Date(l.format("YYYY-MM-DD")),t),s=u.length,c=e._deData[r]?Number(e._deData[r]):0;if(s>0&&c>0){var d=it(c,s),f=u.findIndex((function(t){return K(t).startOf("day").isSame(o)})),p=-1!==f?d[f]:0;a=Math.round(10*(a+p))/10}})),a)},pt=A({name:"TopLevelCell",props:{cellData:{type:Object,required:!0,default:function(){}},showText:{type:Boolean,required:!0,default:!0},capacityConfig:{type:Object,default:function(){}}},emits:["cellClick"],setup:function(t,e){var n=e.emit,r=L("top-level-cell"),a=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,r=n-t/e*n;return"polygon(0px ".concat(r,"%, 100% ").concat(r,"%, 100% ").concat(n,"%, 0px ").concat(n,"%)")};return{ns:r,renderContent:function(){if(!t.cellData.column)return"";var e=function(){var e=t.cellData,n=e.column,r=e.row;switch(t.capacityConfig.calcType){case"WORKITEMCOUNT":return st(n.date,r.data._children);case"ESTIMATEDWORKLOAD":return dt(t.capacityConfig.weekdays,n.date,r.data._children,t.capacityConfig.fieldName);case"REMAININGWORKLOAD":return ft(t.capacityConfig.weekdays,n.date,r.data._children,t.capacityConfig.fieldName)}}()||0,o=function(t,e){var n={};return t<e&&Object.assign(n,{"clip-path":a(t,e)}),n}(e,t.capacityConfig.dayCapacity),i=function(t,e){var n=[];return 0===t?[]:(t>e&&(n=[r.em("caption","exceed")]),t===e&&(n=[r.em("caption","saturation")]),t<e&&(n=[r.em("caption","standard")]),n)}(e,t.capacityConfig.dayCapacity);return j("div",{class:[r.e("caption")].concat(b(i)),onClick:function(e){return function(e){e.stopPropagation(),n("cellClick",t.cellData)}(e)}},[t.showText?j("span",{class:[r.em("caption","text")]},[String(e)]):"",j("div",{class:[r.em("caption","bkg")],style:o},null)])}}},render:function(){return j("div",{class:this.ns.b()},[this.renderContent()])}}),ht=function(t){p(g,t);var e,n,a,l,m=v(g);function g(){return s(this,g),m.apply(this,arguments)}return d(g,[{key:"fetchNodeDatasByType",value:(l=u(r().mark((function t(e,n,a,i){var l,s,d,f,p,h,v,m,y,g,b,w=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s=0===c(this.model,{parentId:e.id,hasQuery:i.hasQuery}).length,d=o(o({},i),{},{leaf:s}),f=[],a||this.model.rootVisible){t.next=10;break}return t.next=6,this.getStaticGanttNodeData(e,n,a,d);case 6:p=t.sent,f=[p],t.next=27;break;case 10:t.t0=e.treeNodeType,t.next="STATIC"===t.t0?13:"DE"===t.t0?18:"CODELIST"===t.t0?22:26;break;case 13:return t.next=15,this.getStaticGanttNodeData(e,n,a,d);case 15:return h=t.sent,f=[h],t.abrupt("break",27);case 18:return t.next=20,this.getDEGanttNodeDatas(e,n,a,d);case 20:case 24:return f=t.sent,t.abrupt("break",27);case 22:return t.next=24,this.getCodeListGanttNodeDatas(e,n,a,d);case 26:throw new J(e,ibiz.i18n.t("runtime.controller.control.gantt.noSupport",{treeNodeType:e.treeNodeType}));case 27:if(v=e.expandFirstOnly,m=e.expanded,y=e.rootNode,g=y&&!this.model.rootVisible,s){t.next=42;break}if(!a||a._parent){t.next=40;break}return t.next=33,Promise.all(f);case 33:return f=t.sent,t.next=36,this.fetchAllChildNodes(f,i);case 36:b=t.sent,f.forEach(function(){var t=u(r().mark((function t(e){var n;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,w.fetchCustomChildNodes(e,i,b||[]);case 2:n=t.sent,e._children=n;case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=42;break;case 40:return t.next=42,Promise.all(f.map(function(){var t=u(r().mark((function t(e,n){var a;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(m&&(!v||v&&0===n)||g)){t.next=5;break}return t.next=3,w.fetchChildNodes(e,i);case 3:a=t.sent,e._children=a;case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()));case 42:return null===(l=f)||void 0===l||l.forEach((function(t){t._beginDataItemValue||(t._beginDataItemValue=t._endDataItemValue),t._endDataItemValue||(t._endDataItemValue=t._beginDataItemValue),t._endDataItemValue&&(t._endDataItemValue="".concat(t._endDataItemValue," 23:59:59"))})),f=this.groupSort(f||[],i.groupField),t.abrupt("return",f);case 45:case"end":return t.stop()}}),t,this)}))),function(t,e,n,r){return l.apply(this,arguments)})},{key:"fetchCustomChildNodes",value:function(t,e,n){var r,a=[];if(t&&n.length>0){var o=e.hasQuery,i=(c(this.model,{parentId:t._nodeId,hasQuery:o})[0]||{}).parentFilter;n.forEach((function(e){i&&e._deData&&t._value===e._deData[i]&&(e._parent=t,a.push(e))}))}return null===(r=a)||void 0===r||r.forEach((function(t){t._beginDataItemValue||(t._beginDataItemValue=t._endDataItemValue),t._endDataItemValue||(t._endDataItemValue=t._beginDataItemValue),t._endDataItemValue&&(t._endDataItemValue="".concat(t._endDataItemValue," 23:59:59"))})),a=this.groupSort(a||[],e.groupField)}},{key:"fetchChildNodes",value:(a=u(r().mark((function t(e,n){var a,o,i,l,s=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.hasQuery,o=[],e){t.next=9;break}return i=f(this.model),t.next=6,this.fetchNodeDatasByType(i,void 0,void 0,n);case 6:o=t.sent,t.next=16;break;case 9:if(0!==(l=c(this.model,{parentId:e._nodeId,hasQuery:a})).length){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,h(l.map(function(){var t=u(r().mark((function t(a){var o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=y(s.model,a.childDETreeNodeId),t.abrupt("return",s.fetchNodeDatasByType(o,a,e,n));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!1);case 14:t.sent.forEach((function(t){var e;(e=o).push.apply(e,b(t))}));case 16:return t.abrupt("return",o);case 17:case"end":return t.stop()}}),t,this)}))),function(t,e){return a.apply(this,arguments)})},{key:"groupSort",value:function(t,e){var n={},r=0;return t.forEach((function(t){var a=t._deData&&t._deData[e]?t._deData[e]:"";a in n||(n[a]=r,r+=1)})),t.sort((function(t,r){return(t._deData&&t._deData[e]?n[t._deData[e]]:-1)-(r._deData&&r._deData[e]?n[r._deData[e]]:-1)})),t}},{key:"getFilterNodes",value:function(t){var e=[];return t.forEach((function(t){t._value&&e.push(t._value)})),e.join(",")}},{key:"fetchAllChildNodes",value:(n=u(r().mark((function t(e,n){var a,i,l,s,d=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.hasQuery,i=[],l=o({},e[0]),0!==(s=c(this.model,{parentId:l._nodeId,hasQuery:a})).length){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,h(s.map(function(){var t=u(r().mark((function t(a){var i,u,s;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=y(d.model,a.childDETreeNodeId),a.parentFilter&&Object.assign(l,{_value:d.getFilterNodes(e)}),u=0===c(d.model,{parentId:i.id,hasQuery:n.hasQuery}).length,s=o(o({},n),{},{leaf:u}),t.abrupt("return",d.getCustomDEGanttNodeDatas(i,a,l,s));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),!1);case 8:return t.sent.forEach((function(t){i.push.apply(i,b(t))})),t.abrupt("return",i);case 11:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"getCustomDEGanttNodeDatas",value:(e=u(r().mark((function t(e,n,a,o){var l,u,s,c,d,f,p,h,v,m,y=this;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return l=e.appDEDataSetId,u=e.appDataEntityId,s=n?this.getNodeRSFilterParams(n,a,o):{context:o.context,params:o.params,navContext:{},navParams:{}},c=s.context,d=s.params,f=s.navContext,p=s.navParams,d.size=e.maxSize||1e3,e.sortAppDEFieldId&&Object.assign(d,{sort:"".concat(e.sortAppDEFieldId.toLowerCase(),",").concat(e.sortDir?e.sortDir.toLowerCase():"asc")}),(h=n?n.parentFilter:"")&&d["n_".concat(h.toLowerCase(),"_eq")]&&(Object.assign(d,i({},"n_".concat(h.toLowerCase(),"_in"),d["n_".concat(h.toLowerCase(),"_eq")])),delete d["n_".concat(h.toLowerCase(),"_eq")]),t.next=8,this.app.deService.exec(u,l,c,d);case 8:if(!(v=t.sent).data.length){t.next=12;break}return m=v.data.map((function(t,n){var r=y.calcExpand(e,n);return new x(y.model,e,a,{data:t,leaf:!!o.leaf,navContext:f,navParams:p,defaultExpand:r})})),t.abrupt("return",m);case 12:return t.abrupt("return",[]);case 13:case"end":return t.stop()}}),t,this)}))),function(t,n,r,a){return e.apply(this,arguments)})}]),g}(l),vt=function(t){p(w,t);var e,a,l,c,f,h,y,b=v(w);function w(){var t;s(this,w);for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return i(m(t=b.call.apply(b,[this].concat(n))),"isInitialLoad",!0),t}return d(w,[{key:"_evt",get:function(){return this.evt}},{key:"initService",value:(y=u(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.service=new ht(this.model),t.next=3,this.service.init(this.context);case 3:case"end":return t.stop()}}),t,this)}))),function(){return y.apply(this,arguments)})},{key:"initState",value:function(){n(g(w.prototype),"initState",this).call(this),this.state.showCapacity=!0,this.state.onlyTopNodes=!1,this.state.showWeekdays=[],this.state.capacityConfig=JSON.stringify({calcType:"WORKITEMCOUNT",fieldName:"",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.work_item_count}"}),this.state.sliderDraggable=!0,this.state.sliderShowContent='"${show_identifier}  ${title}"',this.state.groupConfig={groupField:"project_id"},this.state.contextMap=JSON.stringify({project:"${project_id}"}),this.state.sliderLimit=!0,this.state.expandAll=!1,this.calcDataRange()}},{key:"handleControlParams",value:function(){if(n(g(w.prototype),"handleControlParams",this).call(this),this.controlParams.sliderdraggable&&(this.state.sliderDraggable="true"===this.controlParams.sliderdraggable),this.controlParams.slidershowcontent&&(this.state.sliderShowContent=this.controlParams.slidershowcontent),this.controlParams.groupconfig)try{this.state.groupConfig=JSON.parse(this.controlParams.groupconfig)}catch(t){this.state.groupConfig={}}this.controlParams.sliderlimit&&(this.state.sliderLimit="true"===this.controlParams.sliderlimit),this.controlParams.expandall&&(this.state.expandAll="true"===this.controlParams.expandall),this.controlParams.contextmap&&(this.state.contextMap=this.controlParams.contextmap)}},{key:"setDateRange",value:function(t){this.state.dateRange=t}},{key:"showCapacityChange",value:function(t){this.state.showCapacity=t}},{key:"fullscreenChange",value:function(){this._evt.emit("onFullscreenChange",{})}},{key:"noWeekendDays",value:function(t){this.state.showWeekdays=t?[1,2,3,4,5]:[0,1,2,3,4,5,6]}},{key:"capacityCalcChange",value:function(t){this.state.capacityConfig=JSON.stringify(t)}},{key:"onlyTopNodesChange",value:function(t){this.state.onlyTopNodes=t}},{key:"calcDataRange",value:function(){var t=this.view.getController("searchform");if(t){var e=t.state.data;this.state.dateRange={start:e.n_date_scope_gtandeq,end:e.n_date_scope_ltandeq}}else{var n=new Date;this.state.dateRange={start:K(n.getTime()-6048e5).format("YYYY-MM-DD"),end:K(n).format("YYYY-MM-DD")}}}},{key:"getNodeDataByNodeId",value:function(t){return this.state.items.filter((function(e){return e._nodeId===t})).map((function(t){var e={};return t._deData&&(e=o(o({},t._deData),{},{srfkey:t._deData.srfkey})),e}))}},{key:"load",value:(h=u(r().mark((function t(){var e,a=arguments;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:{},this.calcDataRange(),this.isInitialLoad=!0===e.isInitialLoad,t.abrupt("return",n(g(w.prototype),"load",this).call(this,e));case 4:case"end":return t.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"loadNodes",value:(f=u(r().mark((function t(e){var n,a,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getFetchParams();case 2:return n=t.sent,a=!!n.query,this.state.isLoading=!this.isInitialLoad,t.prev=5,t.next=8,this.service.fetchChildNodes(e,{context:this.context.clone(),params:n,hasQuery:a,groupField:this.state.groupConfig.groupField,defaultExpandedKeys:this.state.expandedKeys});case 8:if(t.t0=t.sent,t.t0){t.next=11;break}t.t0=[];case 11:o=t.t0;case 12:return t.prev=12,this.state.isLoading=!1,t.finish(12);case 15:return e?e._children=o:this.state.rootNodes=o,t.next=18,this.afterLoadNodes(o);case 18:return t.abrupt("return",o);case 19:case"end":return t.stop()}}),t,this,[[5,,12,15]])}))),function(t){return f.apply(this,arguments)})},{key:"startLoading",value:(c=u(r().mark((function t(){return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.ctx.startLoading();case 1:case"end":return t.stop()}}),t,this)}))),function(){return c.apply(this,arguments)})},{key:"openData",value:(l=u(r().mark((function t(e){var n,a,o,i,l,u,s,c,d,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.data,i=e.context,l=e.params,u=o[0],s=this.getNodeModel(u._nodeId),c=s.appDataEntityId,d=C(c),i[d.toLowerCase()]=null===(n=u._deData)||void 0===n?void 0:n.srfkey,t.next=8,null===(a=this.viewScheduler)||void 0===a?void 0:a.triggerCustom("".concat(s.id.toLowerCase(),"_opendata"),{context:i,params:l,data:o,event:void 0,view:this.view,ctrl:this});case 8:if(-1!==(f=t.sent)){t.next=13;break}throw new Error(ibiz.i18n.t("runtime.controller.control.calendar.missingViewLogic",{itemType:s.id.toLowerCase()}));case 13:return t.abrupt("return",{cancel:!f.ok});case 14:case"end":return t.stop()}}),t,this)}))),function(t){return l.apply(this,arguments)})},{key:"save",value:(a=u(r().mark((function t(e){var n,a,o,i,l,u,s,c,d;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.state.isSimple){t.next=3;break}return ibiz.log.debug(ibiz.i18n.t("runtime.controller.common.md.simpleMode")),t.abrupt("return");case 3:if("DE"===e._nodeType){t.next=5;break}throw new Z(ibiz.i18n.t("runtime.controller.control.gantt.nonentity"));case 5:if(n=this.state.rows[e._uuid]){t.next=8;break}throw new Z(ibiz.i18n.t("runtime.controller.common.md.rowData"));case 8:if(n.modified){t.next=11;break}return ibiz.log.debug(ibiz.i18n.t("runtime.controller.common.md.noChange")),t.abrupt("return");case 11:if(!n.processing){t.next=15;break}return t.next=14,X(500,this.save.bind(this),[e]);case 14:return t.abrupt("return");case 15:return a=this.getNodeModel(e._nodeId),o=a.appDataEntityId,i=e._deData.srfuf===_.CREATE,l=C(o),(u=this.context.clone())[l]=e._deData.srfkey,s=nt(this.state.contextMap,e._deData||{})||"{}",Object.assign(u,JSON.parse(s)),c=ibiz.hub.getApp(this.context.srfappid),t.prev=24,t.next=27,c.deService.exec(o,i?"create":"update",u,e._deData);case 27:d=t.sent,t.next=36;break;case 30:return t.prev=30,t.t0=t.catch(24),t.next=34,this.evt.emit("onSaveError",void 0);case 34:throw this.actionNotification("".concat(i?"CREATE":"UPDATE","ERROR"),{error:t.t0,data:n.data}),t.t0;case 36:return n.data._deData=d.data,n.modified=!1,this.gridStateNotify(n,k.SAVE),t.next=41,this.evt.emit("onSaveSuccess",void 0);case 41:case"end":return t.stop()}}),t,this,[[24,30]])}))),function(t){return a.apply(this,arguments)})},{key:"setRowValue",value:(e=u(r().mark((function t(e,n,a){var o,i,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o=this.model,i=o.beginDataItemName,l=o.endDataItemName,!Object.prototype.hasOwnProperty.call(e.data,n)||I(e.data[n],a)){t.next=3;break}return t.abrupt("return");case 3:if(n!==i&&n!==l||(r=e.data[n],u=a,s="day",!K(r).isSame(K(u),s))){t.next=5;break}return t.abrupt("return");case 5:return e.data[n]=a,n===i?e.data._beginDataItemValue=a:n===l&&(e.data._endDataItemValue=a),e.modified=!0,e.processing=!0,t.prev=9,t.next=12,this.dataChangeNotify(e,[n]);case 12:return t.prev=12,e.processing=!1,t.finish(12);case 15:case"end":return t.stop()}var r,u,s}),t,this,[[9,,12,15]])}))),function(t,n,r){return e.apply(this,arguments)})}]),w}(D),mt=A({name:"TotalProgress",props:{row:{type:O,required:!0},controller:{type:vt,required:!0},capacityConfig:{type:Object,required:!0,default:function(){}},dateRange:{type:Object,required:!0,default:function(){}}},setup:function(t){var e=L("total-progress"),n=V(0),r=V(0),a=P((function(){return n.value/r.value*100})),o=function(t,e,n){switch(t.calcType){case"WORKITEMCOUNT":return st(e,n);case"ESTIMATEDWORKLOAD":return dt(t.weekdays,e,n,t.fieldName);case"REMAININGWORKLOAD":return ft(t.weekdays,e,n,t.fieldName);default:return 0}},i=function(){var e=function(e,n,r){var a=r.start,i=r.end,l=0,u=0,s=0;if(n.length>0){for(var c=new Date(a);c<=new Date(i);){if(rt(c,t.capacityConfig.weekdays)){l+=1;var d=o(e,c,n);u=Math.round(10*(u+d))/10}c.setDate(c.getDate()+1)}s=l*e.dayCapacity}return{numerator:u,denominator:s}}(t.capacityConfig,t.row.data._children||[],t.dateRange);n.value=e.numerator,r.value=e.denominator};return z((function(){i(),t.controller._evt.on("onSliderMove",(function(){i()}))})),{ns:e,numerator:n,denominator:r,percentage:a}},render:function(){return j("div",{class:this.ns.b()},[j("span",{class:this.ns.e("caption")},[this.numerator,B(" / "),this.denominator]),j(G("el-progress"),{percentage:this.percentage},null)])}}),yt=A({name:"IBizResourceGanttExFieldColumn",props:{controller:{type:S,required:!0},gantt:{type:vt,required:!0},row:{type:O,required:!0},parentRow:{type:Object},column:{type:Object},capacityConfig:{type:Object,required:!0,default:function(){}},groupConfig:{type:Object,required:!0,default:function(){}},ganttPosition:{type:Object,required:!0,default:function(){}},virtualTableVal:{type:Array,default:function(){return[]}},dateRange:{type:Object,required:!0,default:function(){}},level:{type:Number,default:0},isTopFirstIndex:{type:Boolean,default:!1}},setup:function(t){var e=L("tree-grid-ex-field-column"),n=L("resource-gantt-ex-field-column"),a=V(),o=V({}),i=P((function(){return t.controller.nodeColumnControllerMap.get(t.row.data._nodeId)})),l=P((function(){return"DE"!==t.row.data._nodeType&&t.controller.isFirstShowColumn?t.row.data._text:t.row.data[t.controller.name]})),s=V(""),c=P((function(){var t=i.value;if(t){if(t.nodeEditItem)return;return t.codeList?s.value:t.formatValue(l.value)+(t.unitName||"")}return l.value})),d=P((function(){if("ellipsis"===t.controller.treeGrid.overflowMode&&tt(l.value)&&""!==l.value)return c.value})),f=P((function(){return l.value&&i.value&&(i.value.isLinkColumn||i.value.hasClickAction)})),p=function(){var e=u(r().mark((function e(n,a){var o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(o=i.value)||void 0===o?void 0:o.onActionClick(n,t.row,a);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),h=function(e,n,r){var a,o=e.data;if(o&&o._children&&o._children.length>1){var i=o._children.find((function(t){return n.data&&t._deData&&n.data._deData&&t._deData[r.groupField]===n.data._deData[r.groupField]}));if(i&&(a=i._id,!t.virtualTableVal.find((function(t){return t.data._id===a})))){var l=t.virtualTableVal.find((function(t){return n.data&&t.data._deData&&n.data._deData&&t.data._deData[r.groupField]===n.data._deData[r.groupField]}));return l&&n.data._id===l.data._id}return i&&n.data._id===i._id}return!1};var v=P((function(){var e="",n=t.parentRow,r=t.row;return t.level>1&&n&&function(t,e,n){var r=t.data;return r&&r._children&&r._children.length>1?r._children.reduce((function(t,r){return e.data&&r._deData&&e.data._deData&&r._deData[n.groupField]===e.data._deData[n.groupField]?t+1:t}),0):0}(n,r,t.groupConfig)>1&&(e=h(n,r,t.groupConfig)?"first-index":"no-first-index"),e})),m=P((function(){var e={},n=t.level,r=t.parentRow,i=t.row;if(n&&n>1&&r&&r.data._children&&r.data._children.length>1){var l=function(e,n,r){var a=e.data;if(a&&a._children&&a._children.length>1){var o=a._children.findIndex((function(t){return n.data&&t._deData&&n.data._deData&&t._deData[r.groupField]===n.data._deData[r.groupField]&&n.data._id===t._id}));if(-1!==o&&h(e,n,t.groupConfig))return a._children.slice(o).reduce((function(t,e){return n.data&&e._deData&&n.data._deData&&e._deData[r.groupField]===n.data._deData[r.groupField]?t+1:t}),0)}return 0}(r,i,t.groupConfig);if(l>1){var u=46*l-20;Object.assign(e,{height:"".concat(u,"px")}),function(){if(o.value={},a.value){var e=function(t,e){for(var n=t;n&&1===n.nodeType;){if(n.classList.contains(e))return n;n=n.parentNode}return null}(a.value,"xg-table-row");if(e){var n=t.ganttPosition,r=lt(e),i=ut(e);r<n.top+46&&(r=n.top+46),i<n.bottom&&(i=n.bottom);var l=((window.innerHeight||document.documentElement.clientHeight)-r-i)/2+r-23;l>r&&(o.value={position:"fixed",top:"".concat(l,"px")})}}}()}}return e}));return{ns:e,ns2:n,nodeColumn:i,fieldValue:l,showText:c,clickable:f,tooltip:d,calcMergeClass:v,calcMergeStyle:m,columnRef:a,contentStyle:o,onInfoTextChange:function(t){s.value=t},onTextClick:function(e){var n;null===(n=i.value)||void 0===n||n.onTextClick(t.row,e)},onActionClick:p}},render:function(){var t,e,n,r,a,o,i=null;if(i=null!==(t=this.nodeColumn)&&void 0!==t&&t.nodeEditItem?j(G("iBizTreeGridExEditColumn"),{controller:this.nodeColumn,row:this.row},null):null!==(e=this.nodeColumn)&&void 0!==e&&e.codeList?j(G("iBizCodeList"),{class:this.ns.e("text"),codeListItems:this.nodeColumn.codeListItems,codeList:this.nodeColumn.codeList,value:this.fieldValue,onClick:this.onTextClick,onInfoTextChange:this.onInfoTextChange,title:this.tooltip},null):j("span",{class:[this.ns.e("text"),this.ns2.e("text")],title:this.tooltip,onClick:this.onTextClick,style:this.contentStyle},[this.showText]),this.$slots.actions)o=this.$slots.actions();else if(this.row.columnActionsStates[this.controller.name]){var l;o=j(It,{class:this.ns.e("toolbar"),actionDetails:null===(l=this.nodeColumn)||void 0===l?void 0:l.nodeColumn.deuiactionGroup.uiactionGroupDetails,actionsState:this.row.columnActionsStates[this.controller.name],mode:"dropdown",popperClass:this.ns2.b("popper"),groupLevelKeys:[],onActionClick:this.onActionClick},null)}var u=null;return 1===this.level&&(u=j(mt,{row:this.row,controller:this.gantt,capacityConfig:this.capacityConfig,dateRange:this.dateRange},null)),j("div",{ref:"columnRef",class:[this.ns.b(),this.ns2.b(),this.clickable&&this.ns.m("clickable"),this.ns.m(this.controller.treeGrid.overflowMode),null===(n=this.controller.model.cellSysCss)||void 0===n?void 0:n.cssName,this.ns.is("has-action",!!o),null!==(r=this.row)&&void 0!==r&&r.data._children&&0===(null===(a=this.row)||void 0===a||null===(a=a.data._children)||void 0===a?void 0:a.length)?"no-children":"",this.isTopFirstIndex?"top-first-index":"",this.calcMergeClass],style:this.calcMergeStyle},[j("div",{class:[this.ns.b("text-container"),this.ns2.b("text-container")]},[i]),o,u])}}),gt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M6.751 12.303A5.557 5.557 0 0 1 1.2 6.751C1.2 3.691 3.69 1.2 6.751 1.2a5.558 5.558 0 0 1 5.551 5.551 5.557 5.557 0 0 1-5.551 5.552M6.751 0a6.751 6.751 0 1 0 4.309 11.949l3.855 3.855a.6.6 0 1 0 .849-.849l-3.854-3.853A6.751 6.751 0 0 0 6.751 0"},null)])])},bt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("g",{transform:"translate(3.347 1.67)"},[j("path",{d:"M8.31 4.544l-3.858-3.01L.757 4.537 0 3.606 4.435 0l4.613 3.598-.738.946zM.778 7.934l3.805 3.077L8.33 8.074l.74.944-4.497 3.528-4.55-3.679.755-.933z"},null)])])])},wt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em",focusable:"false"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("g",{transform:"translate(3.347 1.67)"},[j("path",{d:"M.738 0l3.858 3.01L8.291.008l.757.93-4.435 3.606L0 .946.738 0zM8.31 12.544l-3.858-3.01-3.695 3.003L0 11.606 4.435 8l4.613 3.598-.738.946z"},null)])])])},xt=function(){return j("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024",height:"1em",width:"1em","data-v-6fbb019e":""},[j("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.752 512 214.528 764.224a31.936 31.936 0 1 0 45.12 45.184L512 557.184l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512.064l252.288-252.352a31.936 31.936 0 1 0-45.12-45.184z"},null)])},Dt=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16zm0-1.2A6.8 6.8 0 1 0 8 1.2a6.8 6.8 0 0 0 0 13.6zm.017-10V8.42H11.7v1.2H6.817V4.8h1.2z"},null)])])},Ct=function(){return j("svg",{viewBox:"0 0 16 16",version:"1.1",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M13.9940802,1 L13.9940802,2.2 L13.2624694,2.20103326 C12.93604,4.83947485 11.5126604,7.09238002 9.63519201,7.94035881 C11.5358297,8.8013205 12.9480925,11.1932677 13.2658805,13.8999459 L13.9940802,13.9 L13.9940802,15.1 L2.00217741,15.1 L2.00217741,13.9 L2.73926874,13.9002831 C3.07603558,11.2316386 4.55055745,8.86884631 6.45182913,7.97728733 C4.5311544,7.16123279 3.06895466,4.87984542 2.73753056,2.20103326 L2.00217741,2.2 L2.00217741,1 L13.9940802,1 Z M8.09238129,8.79975967 C6.27968763,8.79975967 4.50087608,10.8991568 4.003456,13.5719701 L3.95733333,13.85 L12.0513333,13.85 L12.0453334,13.8079643 C11.6544503,11.0697148 10.0166737,8.92538307 8.2486894,8.80508513 L8.09238129,8.79975967 Z M12.0446667,2.25 L3.95366667,2.25 L3.96063026,2.29291849 C4.36564997,4.94375371 6.02387547,6.97732036 7.834965,7.09464882 L8,7.1 C9.81589788,7.1 11.5127277,5.15179966 11.9963879,2.54700205 L12.0446667,2.25 Z"},null)])])},_t=function(){return j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M12.777 13.107V3.88a.621.621 0 0 0-.621-.62h-.76v.216a.977.977 0 0 1-.975.978h-4.9a.978.978 0 0 1-.977-.978v-.216H3.82a.62.62 0 0 0-.62.62v9.226c0 .341.278.62.62.62h8.336a.621.621 0 0 0 .62-.62zM5.744 3.255h4.453V2.2H5.744v1.054zm6.412-1.194c1.004 0 1.82.817 1.82 1.82v9.226a1.821 1.821 0 0 1-1.82 1.819H3.82A1.822 1.822 0 0 1 2 13.105V3.88c0-1.002.817-1.82 1.82-1.82h.724v-.084c0-.538.438-.976.977-.976h4.9c.538 0 .975.438.975.976v.085h.76zm-1.77 4.782a.6.6 0 0 1 .833.863l-3.688 3.562c-.002.003-.002.006-.005.009a.601.601 0 0 1-.849-.004L4.748 9.326a.599.599 0 1 1 .852-.844l1.511 1.524 3.274-3.163z"},null)])])},kt=A({name:"ResourceGanttColumnHead",props:{controller:{type:vt,required:!0,default:function(){}},model:{type:Object,required:!0,default:function(){}},expandAll:{type:Boolean,required:!0,default:!1},titleData:{type:Object,required:!0,default:function(){}}},emits:["expandAllChange","headSearch"],setup:function(t,e){var n=e.emit,a=t.controller,o=L("resource-gantt-column-head"),i=V(!1),l=V(!1),s=V(""),c=P((function(){return t.titleData.label}));F((function(){return t.expandAll}),(function(t){i.value=t}),{immediate:!0});var d=function(){i.value=!i.value,n("expandAllChange",i.value)},f=function(){n("headSearch",s.value)},p=function(t){t.preventDefault(),t.stopPropagation(),l.value=!1,n("headSearch","")},h=function(){var e=u(r().mark((function e(n,a){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.controller.doUIAction(n.uiactionId,{},a,n.appId);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),v=function(){return j(G("el-input"),{modelValue:s.value,"onUpdate:modelValue":function(t){return s.value=t},class:o.b("search"),onInput:f,placeholder:"搜索成员"},{prefix:function(){return j(gt,null,null)},suffix:function(){return j(G("el-button"),{class:o.be("search","suffix"),onClick:p},{default:function(){return[j(xt,null,null)]}})}})},m=function(){var t,e=a.getNodeModel("root"),n=a.state.selectedData;if(null!=e&&null!==(t=e.decontextMenu)&&void 0!==t&&null!==(t=t.detoolbarItems)&&void 0!==t&&t.length){var r=a.contextMenuInfos[e.id];return r.clickTBUIActionItem&&r.onlyOneActionItem?null:j(G("iBizContextMenuControl"),{modelData:e.decontextMenu,groupLevelKeys:[50],nodeModel:e,nodeData:n,context:a.context,onActionClick:function(t,e){return h(t,e)}},null)}};return{c:a,ns:o,label:c,isHeadSearch:l,expand:i,renderHeadSearch:v,onColumnHeadClick:function(t){t.preventDefault(),t.stopPropagation()},onExpandAllChange:d,renderContent:function(){return l.value?v():j("div",{class:o.b("box")},[j("div",{class:o.be("box","left")},[j(G("el-button"),{class:o.bem("box","left","icon"),title:i.value?"全部收起":"全部展开",onClick:d},{default:function(){return[i.value?j(wt,null,null):j(bt,null,null)]}}),j("div",{class:o.bem("box","left","caption")},[c.value])]),j("div",{class:o.be("box","right")},[j(G("el-button"),{size:"small",title:"搜索成员",class:[o.e("item")],onClick:function(t){return function(t,e){e.stopPropagation(),l.value=!0}(0,t)}},{icon:function(){return j("div",{class:o.e("icon")},[j(gt,null,null)])}}),m()])])}}},render:function(){return j("div",{class:this.ns.b()},[this.renderContent()])}});var It=A({name:"IBizResourceActionToolbar",props:{actionDetails:{type:Array,required:!0},actionsState:{type:Object,required:!0},caption:String,mode:{type:String,default:"buttons"},groupLevelKeys:{type:Object,default:[50]},zIndex:{type:Number},popperClass:String},emits:["actionClick"],setup:function(t,e){var n,a=e.emit,o=L("action-toolbar"),i=L("resource-action-toolbar"),l=V(),s=V(!1),c=V(!1);null===(n=t.actionDetails)||void 0===n||n.forEach((function(t){t.capLanguageRes&&t.capLanguageRes.lanResTag&&(t.caption=ibiz.i18n.t(t.capLanguageRes.lanResTag,t.caption)),t.tooltipLanguageRes&&t.tooltipLanguageRes.lanResTag&&(t.tooltip=ibiz.i18n.t(t.tooltipLanguageRes.lanResTag,t.tooltip))}));var d=function(){var e=u(r().mark((function e(n,o){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.stopPropagation(),"buttons"===t.mode?s.value=!1:l.value&&l.value.handleClose(),a("actionClick",n,o);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),f=V([]),p=V([]);t.actionDetails&&t.actionDetails.forEach((function(e){-1!==t.groupLevelKeys.findIndex((function(t){return t===e.actionLevel}))?p.value.push(e):f.value.push(e)}));var h=V(),v=t.zIndex;return{ns:o,ns2:i,dropdownRef:l,popoverIndex:v,expandDetails:f,groupDetails:p,groupButtonRef:h,popoverVisible:s,dropdownVisible:c,handleClick:d,calcActionItemClass:function(t){var e=t.actionLevel;return[o.e("item"),o.is("disabled",!1),o.em("item","level-".concat(e))]},onVisibleChange:function(t){c.value=t}}},render:function(){var t,e=this,n=this.actionDetails||[],r=function(t){return j(G("el-divider"),{class:e.ns.e("separator"),"border-style":"double",direction:t?"vertical":"horizontal"},null)},a=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.map((function(t){return e.actionsState[t.id].visible?[t.addSeparator&&r(n),j(G("el-button"),{text:!0,size:"small",onClick:function(n){return e.handleClick(t,n)},title:t.tooltip,disabled:e.actionsState[t.id].disabled,class:e.calcActionItemClass(t)},{default:function(){return[j("div",{class:e.ns.em("item","icon")},[t.showIcon&&t.sysImage&&j(G("iBizIcon"),{icon:t.sysImage},null)]),j("div",{class:e.ns.em("item","label")},[t.showCaption?t.caption:""])]}})]:null}))};if(null!==(t=this.actionsState)&&void 0!==t&&t.visible)return"buttons"===this.mode?j("div",{class:[this.ns.b(),this.ns.m("buttons")],onClick:function(t){return t.stopPropagation()}},[a(this.expandDetails),function(){var t;if(0===e.groupDetails.length)return null;if(-1===e.groupDetails.findIndex((function(t){return!0===e.actionsState[t.id].visible})))return null;var n,r=-1===e.groupDetails.findIndex((function(t){return!1===e.actionsState[t.id].disabled}));return[j(G("el-button"),{size:"small",text:!0,disabled:r,ref:"groupButtonRef",class:[e.ns.e("item"),e.ns.is("expand",e.popoverVisible)]},{icon:function(){return j(G("ion-icon"),{class:e.ns.e("icon"),name:"ellipsis-vertical-outline",title:ibiz.i18n.t("component.actionToolbar.more")},null)}}),j(G("el-popover"),{placement:"bottom-start","virtual-ref":e.groupButtonRef,trigger:"click",visible:e.popoverVisible,"onUpdate:visible":function(t){return e.popoverVisible=t},"popper-class":e.ns.e("popover"),"virtual-triggering":!0,"popper-style":"z-index:".concat(e.popoverIndex)},(n=t=a(e.groupDetails,!1),"function"==typeof n||"[object Object]"===Object.prototype.toString.call(n)&&!q(n)?t:{default:function(){return[t]}}))]}()]):j(G("el-dropdown"),{ref:"dropdownRef",onCommand:function(t){return e.handleClick(t,new MouseEvent("click"))},trigger:"click",class:[this.ns.b(),this.ns.m("dropdown"),this.dropdownVisible?this.ns2.e("open"):""],placement:"bottom-start","popper-class":this.popperClass,onVisibleChange:this.onVisibleChange},{default:function(){return j("span",{class:e.ns.e("caption")},[e.caption,j(G("ion-icon"),{class:e.ns.e("caption-icon"),name:"ellipsis-vertical-outline"},null)])},dropdown:function(){return j(G("el-dropdown-menu"),null,{default:function(){return[n.length>0&&n.map((function(t){return e.actionsState[t.id].visible?j(G("el-dropdown-item"),{class:[e.ns.e("item"),e.ns.is("disabled",!1)],title:t.tooltip,disabled:e.actionsState[t.id].disabled,command:t},{default:function(){return[t.showIcon&&t.sysImage&&j(G("iBizIcon"),{icon:t.sysImage},null),t.showCaption?t.caption:""]}}):null}))]}})}})}}),Ot=function(t){p(n,t);var e=v(n);function n(){return s(this,n),e.apply(this,arguments)}return d(n)}(N),St=A({name:"IBizPanelResourceState",props:{modelData:{type:Object,required:!0},controller:{type:Ot,required:!0}},setup:function(t){var e=L("panel-rawitem"),n=L("panel-resource-state"),r=V(""),a=[{tag:"standard",name:"标准"},{tag:"saturation",name:"饱和"},{tag:"exceed",name:"超出"}],o=t.modelData.rawItem;o&&o.cssStyle&&(r.value=o.cssStyle);var i=P((function(){var r=t.modelData.id,a=[e.b(),n.b(),e.m(r)];return a.push.apply(a,b(t.controller.containerClass)),a}));return{ns:e,classArr:i,tempStyle:r,renderContent:function(){return a.map((function(t){return j("div",{class:[n.e("content"),n.e(t.tag)]},[j("div",{class:[n.em("content","star")]},null),j("div",{class:n.em("content","caption")},[t.name])])}))}}},render:function(){var t=this;if(this.controller.state.visible)return j("div",{class:this.classArr,style:this.tempStyle,onClick:function(){t.controller.onClick()}},[this.renderContent()])}}),Et=function(){function t(){s(this,t),i(this,"component","IBizPanelResourceState")}var e;return d(t,[{key:"createController",value:(e=u(r().mark((function t(e,n,a){var o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new Ot(e,n,a),t.next=3,o.init();case 3:return t.abrupt("return",o);case 4:case"end":return t.stop()}}),t)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}(),Tt=R(St,(function(t){t.component(St.name,St),E("CUSTOM_RESOURCE_STATE",(function(){return new Et}))})),Lt=function(t){p(n,t);var e=v(n);function n(){return s(this,n),e.apply(this,arguments)}return d(n)}(N),Nt=A({name:"IBizResourceDropdownList",props:{modelData:{type:Object,required:!0},controller:{type:Lt,required:!0}},setup:function(t){var e=L("dropdown"),n=L("resource-dropdown-list"),r=t.controller,a=V(""),o=V({}),i=V([]),l=[{label:"容量计算"},{calcType:"WORKITEMCOUNT",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.work_item_count}",label:"工作项数量",icon:_t},{calcType:"ESTIMATEDWORKLOAD",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.estimated_workload}",fieldName:"estimated_workload",label:"预估工时",icon:Dt},{calcType:"REMAININGWORKLOAD",weekdays:"${weekday}",dayCapacityVal:"${day_capacity.remaining_workload}",fieldName:"remaining_workload",label:"剩余工时",icon:Ct}],u=t.modelData.rawItem;u&&u.cssStyle&&(a.value=u.cssStyle);var s=P((function(){var r=t.modelData.id,a=[e.b(),n.b(),e.m(r)];return a.push.apply(a,b(t.controller.containerClass)),a}));z((function(){i.value=l,o.value=l[1]}));var c=function(e){o.value=e;var n={};(Object.assign(n,e),delete n.icon,t.controller.panel.panelItems&&t.controller.panel.panelItems.gantt)&&t.controller.panel.panelItems.gantt.control.capacityCalcChange(n)};return{ns:e,ns2:n,c:r,curValue:o,items:i,classArr:s,tempStyle:a,handleItemClick:c,renderContent:function(){return j(G("el-dropdown"),{trigger:"click",class:n.b("dropdown"),"popper-class":n.b("dropdown-popper")},{default:function(){return j("span",{class:n.be("dropdown","content")},[o.value.icon&&j("span",{class:n.bem("dropdown","content","icon")},[o.value.icon()]),j("span",{class:n.bem("dropdown","content","text")},[o.value.label])])},dropdown:function(){return j(G("el-dropdown-menu"),null,{default:function(){return i.value.map((function(t){return j(G("el-dropdown-item"),{onClick:function(){return c(t)}},{default:function(){return[j("div",{class:n.be("dropdown-popper","content")},[t.icon&&j("span",{class:n.bem("dropdown-popper","content","icon")},[t.icon()]),j("span",{class:n.bem("dropdown-popper","content","text")},[t.label]),o.value.calcType===t.calcType&&j("span",{class:n.bem("dropdown-popper","content","correct")},[j("svg",{viewBox:"0 0 16 16",xmlns:"http://www.w3.org/2000/svg",height:"1em",width:"1em"},[j("g",{"stroke-width":"1","fill-rule":"evenodd"},[j("path",{d:"M6.012 11.201L1.313 6.832l-.817.879 5.54 5.15 9.304-9.163-.842-.855z"},null)])])])])]}})}))}})}})}}},render:function(){return j("div",{class:this.classArr,style:this.tempStyle},[this.renderContent()])}}),Rt=function(){function t(){s(this,t),i(this,"component","IBizResourceDropdownList")}var e;return d(t,[{key:"createController",value:(e=u(r().mark((function t(e,n,a){var o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new Lt(e,n,a),t.next=3,o.init();case 3:return t.abrupt("return",o);case 4:case"end":return t.stop()}}),t)}))),function(t,n,r){return e.apply(this,arguments)})}]),t}(),Mt=R(Nt,(function(t){t.component(Nt.name,Nt),E("CUSTOM_RESOURCE_DROPDOWN_LIST",(function(){return new Rt}))}));function At(){var t=V(!1),e=function(t,e){return{curDate:K(t),rangeStart:K(e.start).startOf("day"),rangeEnd:K(e.end).startOf("day").add(1,"day").subtract(1,"second")}};return{handleEmitMove:function(e,n){var r,a=e.startDate,o=e.endDate,i=a.clone(),l=o.clone();r=t.value?function(t){var e=t.startDate,n=t.endDate,r=t.dateRange,a=t.sliderLimit,o=K(e.date),i=K(n.date),l=i.diff(o,"hour");if(o.diff(o.startOf("day"),"hour")<12){if(o=o.startOf("day"),i=i.subtract(1,"day").startOf("day"),a&&r){var u=K(r.end).startOf("day").add(1,"day").subtract(1,"second"),s=K(r.start).startOf("day");(K(n.date).isAfter(u)||K(n.date).isSame(u))&&(i=u),(K(e.date).isBefore(s)||K(e.date).isSame(s))&&(o=s)}24===l&&(i=o)}else i=i.startOf("day"),o=o.add(1,"day").startOf("day"),24===l&&(o=i);return{start:o,end:i=i.add(1,"day").startOf("day").subtract(1,"second")}}(e):function(t){var e=t.startDate,n=t.endDate,r=K(e.date),a=K(n.date);return{start:r=r.startOf("day"),end:a=a.startOf("day").add(1,"day").subtract(1,"second")}}(e),t.value=!1,i.setDate(K(r.start)),l.setDate(K(r.end)),n({startDate:i,endDate:l,unit:"hour"})},handleSetStart:function(n,r){var a,o=n.x,i=n.type,l=n.startDate,u=n.endDate,s=n.sliderLimit,c=n.dateRange,d=n.ganttColumnWidth,f=n.currentMillisecond;t.value=!0;var p=l.getOffset(o/d*f).clone();"resize"===i&&(t.value=!1);var h=0;if(s&&c){var v=e(l.date,c),m=v.rangeStart,y=v.rangeEnd,g=u.getOffset(o/d*f),b=K(u.date),w=K(l.date),x=K(p.date),D=K(g.date);if("resize"===i){var C=b.subtract(1,"day").add(1,"second");x.isAfter(C)&&(p.setDate(C.toDate()),x=K(p.date)),x.isAfter(y.startOf("day"))&&(p.setDate(y.startOf("day").toDate()),x=K(p.date))}else{if(w.isBefore(m.add(1,"day"),"day")&&b.isAfter(y.subtract(1,"day"),"day"))return o;D.isAfter(y)&&(g.setDate(y.toDate()),D=K(g.date));var _=b.diff(w,"second"),k=D.diff(x,"second"),I=D.subtract(_,"second");h=D.add(1,"second").valueOf()-I.valueOf(),k>0&&k<=_&&I.isAfter(m)&&(p.setDate(I.toDate()),x=K(p.date))}x.isBefore(m)&&p.setDate(m.toDate())}return("r"===p.compareTo(u.getOffset(-864e5))||h>0)&&"resize"!==i&&(a=p.getOffset(h>0?h:864e5)),r({startDate:p,endDate:a,unit:"hour"}),o},handleSetEnd:function(n,r){var a=n.x,o=n.type,i=n.startDate,l=n.endDate,u=n.sliderLimit,s=n.dateRange,c=n.ganttColumnWidth,d=n.currentMillisecond;t.value=!0;var f,p=0,h=l.getOffset(a/c*d).clone();if("resize"===o&&(t.value=!1),u&&s){var v=e(l.date,s),m=v.rangeStart,y=v.rangeEnd,g=i.getOffset(a/c*d),b=K(i.date),w=K(l.date),x=K(h.date),D=K(g.date);if("resize"===o){var C=b.add(1,"day").subtract(1,"second");x.isBefore(C)&&(h.setDate(C),x=K(h.date)),x.isBefore(m.startOf("day").add(1,"day").subtract(1,"second"))&&(h.setDate(m.startOf("day").add(1,"day").subtract(1,"second").toDate()),x=K(h.date))}else{if(b.isBefore(m.add(1,"day"),"day")&&w.isAfter(y.subtract(1,"day"),"day"))return a;if(D.isBefore(m))return a;var _=w.diff(b,"second"),k=x.diff(D,"second"),I=D.add(_+1,"second");p=I.valueOf()-D.valueOf(),k>0&&k<=_&&I.isBefore(y)&&(h.setDate(I),x=K(h.date))}x.isAfter(y)&&h.setDate(y)}return"l"===h.compareTo(i.getOffset(864e5))&&"resize"!==o&&(f=h.getOffset(p>0?-p:-864e5)),r({startDate:f,endDate:h,unit:"hour"}),a},handleSliderLeft:function(t){var e=t.startDate,n=t.ganttHeader,r=t.currentMillisecond,a=t.ganttColumnWidth;return e.intervalTo(n.start)/r*a},handleSliderWidth:function(t){var e=t.startDate,n=t.endDate,r=t.currentMillisecond,a=t.ganttColumnWidth;return n.intervalTo(e)/r*a}}}var jt=A({name:"IBizResourceGanttControl",props:{modelData:{type:Object,required:!0},context:{type:Object,required:!0},params:{type:Object,default:function(){return{}}},provider:{type:Object},loadDefault:{type:Boolean,default:!0},mdctrlActiveMode:{type:Number,default:void 0},singleSelect:{type:Boolean,default:void 0}},setup:function(t){var n,i=M((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e(vt,n)})),l=V(),s=V(),c=V(!1),d=L("control-".concat(i.model.controlType.toLowerCase())),f=L("control-resource-gantt"),p=V(),h=V(!0),v=At(),m=v.handleEmitMove,y=v.handleSetStart,g=v.handleSetEnd,w=v.handleSliderLeft,x=v.handleSliderWidth,D=V();D.value=U();var C=G("IBizRawItem"),_=G("IBizIcon"),k=!1,I=V({top:0,bottom:0}),O=V([]),S=function(){var t;if(Object.assign(I.value,{top:0,bottom:0}),s.value&&null!==(t=s.value)&&void 0!==t&&t.$el){var e,n,r=lt(null===(e=s.value)||void 0===e?void 0:e.$el),a=ut(null===(n=s.value)||void 0===n?void 0:n.$el);Object.assign(I.value,{top:r,bottom:a})}},E=[],T=["blue","light-blue","blue-cyan","pink","purple","violet","indigo","cyan","teal","green","light-green","lime","yellow","amber","orange","grey","sky-blue"],N=V(!1),R=new ResizeObserver((function(){s.value&&0!==s.value.$el.offsetWidth&&(N.value=function(){if(s.value){var t=s.value.$el,e=t.querySelector(".xg-gantt-container"),n=t.querySelector(".xg-gantt-body");return e.offsetWidth===n.offsetWidth}return!1}())}));F(s,(function(t){if(t&&t.$el){var e=t.$el.querySelector(".xg-gantt-body");R.observe(e)}}));var A=null===(n=Y())||void 0===n?void 0:n.appContext.app;z((function(){a.import("@ibiz-template-plugin/gantt").then((function(t){var e=t.default;null==A||A.use(e),c.value=!0}))}));var B=function(t){var e=document.documentElement;return getComputedStyle(e).getPropertyValue(t)},q=P((function(){var t,e;return{primaryColor:(null===(t=i.state.ganttStyle)||void 0===t?void 0:t.primaryColor)||B("--ibiz-color-bg-0"),textColor:(null===(e=i.state.ganttStyle)||void 0===e?void 0:e.textColor)||B("--ibiz-color-text-2")}})),W=P((function(){var t,e={};return null===(t=i.model.detreeNodes)||void 0===t||t.forEach((function(t,n){var r=n%T.length;e[t.id]="rgba(".concat(B("--ibiz-".concat(T[r],"-0")),", 1)")})),e})),$=P((function(){return!!i.state.isLoaded&&i.state.isLoading})),Q=P((function(){var t,e,n;return i.state.onlyTopNodes?(n=i.state.rootNodes,i.model.rootVisible||(n=(null===(e=i.state.rootNodes[0])||void 0===e?void 0:e._children)||[]),n.map((function(t){var e={};return Object.assign(e,t),e._children&&(e._children=null),e}))):i.model.rootVisible?i.state.rootNodes:null===(t=i.state.rootNodes[0])||void 0===t||null===(t=t._children)||void 0===t?void 0:t.filter((function(t){return!p.value||t.name.includes(p.value)}))})),J=P((function(){var t=[];return i.state.columnStates.forEach((function(e){var n,r=null===(n=i.columns[e.key])||void 0===n?void 0:n.model;!e.hidden&&r&&t.push(r)})),t})),Z=P((function(){return ibiz.i18n.getLang().toLowerCase()})),X=function(t,e){k||h.value?h.value=!1:(i.onTreeNodeClick(t,e),k=!0,setTimeout((function(){k=!1}),200))},tt=function(t){i.onDbTreeNodeClick(t)};i.evt.on("onNewRow",(function(t){if(l.value){var e=t.row.data;l.value.setExpand(e)}}));var ot=function(){var t;null===(t=l.value)||void 0===t||t.fullscreenChange()};i._evt.on("onFullscreenChange",(function(t){ot()}));var it,st=function(t){p.value=t},ct=function(t){i.state.expandAll=t},dt=function(t){console.log("抛值内容",t)},ft=function t(e,n,r,a){var o=[];return e.forEach((function(e){if("SEPERATOR"!==e.itemType){var l=a[e.id];if(!l||l.visible){var u={};if(e.showCaption&&e.caption&&(u.label=e.caption),e.sysImage&&e.showIcon&&(u.icon=j(_,{icon:e.sysImage},null)),"DEUIACTION"===e.itemType){u.disabled=l.disabled,u.clickClose=!0;var s=e.uiactionId;s&&(u.onClick=function(){i.doUIAction(s,n,r,e.appId)})}else if("RAWITEM"===e.itemType){e.rawItem&&(u.label=j(C,{rawItem:e},null))}else if("ITEMS"===e.itemType){var c;null!==(c=e.detoolbarItems)&&void 0!==c&&c.length&&(u.children=t(e.detoolbarItems,n,r,a))}o.push(u)}}else o.push({divided:"self"})})),o};i.evt.on("onMounted",(function(){if(Object.values(i.contextMenus).length>0){a.import("@imengyu/vue3-context-menu").then((function(t){(it=t.default).default&&!it.showContextMenu&&(it=it.default)}))}}));var ht=function(){var t=u(r().mark((function t(e,n){var a,o,l,u;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n.stopPropagation(),n.preventDefault(),null!=(a=i.getNodeModel(e._nodeId))&&a.decontextMenu){t.next=5;break}return t.abrupt("return");case 5:if((o=i.contextMenus[a.decontextMenu.id]).model.detoolbarItems){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,o.calcButtonState(e._deData||(e.srfkey?e:void 0),a.appDataEntityId);case 10:if(l=o.state.buttonsState,(u=ft(o.model.detoolbarItems,e,n,l)).length){t.next=14;break}return t.abrupt("return");case 14:it.showContextMenu({x:n.x,y:n.y,customClass:d.b("context-menu"),items:u});case 15:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return{c:i,ns:d,ns2:f,fullscreenChange:ot,ganttRef:l,ganttBoxRef:s,isInited:c,ganttId:D,data:Q,locale:Z,columns:J,onCheck:function(t,e){if(t)E.push(e);else{var n=E.findIndex((function(t){return t._id===e._id}));n>-1&&E.splice(n,1)}i.setSelection(E)},loading:$,ganttStyle:q,isGanttWidthEq:N,onNodeClick:X,onNodeDbClick:tt,onNodeExpand:function(t){i.onExpandChange(t,!0),t&&!t._children&&i.refreshNodeChildren(t)},onNodeCollapse:function(t){i.onExpandChange(t,!1)},renderContent:function(){var t=J.value.map((function(t,e){return function(t,e){var n=t.caption,r=t.codeName,a=t.width,o=t.headerSysCss,l=t.align,u=i.columns[r];return j(G("x-gantt-column"),{label:n,prop:r,width:a&&a>30?a:30,center:"center"===(null==l?void 0:l.toLowerCase())},{title:function(e){var n=e.label;return"name"===r?j(kt,{key:r,model:t,controller:i,titleData:e,expandAll:i.state.expandAll,class:null==o?void 0:o.cssName,onExpandAllChange:ct,onHeadSearch:st},null):j("div",{class:null==o?void 0:o.cssName},[n])},default:function(t){var e=t.row,n=t.column,a=t.level,o=i.getRowState(e._id);if(o){if("name"===r){var l,s=at(o,i.state.capacityConfig);e._parent&&(l=i.getRowState(e._parent._id));var c=!(!Q.value||!Q.value[0])&&Q.value[0]._id===o.data._id;return S(),j(yt,{controller:u,gantt:i,capacityConfig:s,dateRange:i.state.dateRange,groupConfig:i.state.groupConfig,row:o,parentRow:l,column:n,level:a,isTopFirstIndex:c,key:o.data._uuid+r,ganttPosition:I.value,virtualTableVal:O.value},null)}var d=G(i.providers[r].component);return H(d,{controller:u,row:o,key:o.data._uuid+r})}return null}})}(t)})),e=j(G("x-gantt-slider"),{"allow-link":!1,move:i.state.sliderDraggable,"resize-left":i.state.sliderDraggable,"resize-right":i.state.sliderDraggable,"move-by-unit":!0,"slider-limit":i.state.sliderLimit,"emit-move":m,"set-start":y,"set-end":g,"slider-left":w,"slider-width":x},{content:function(t){var e=t.row,n=t.level,r=t.left;if(1!==n){var a=nt(i.state.sliderShowContent,e._deData||{}).replace(/^"(.*?)"$/,"$1"),o=r<0?"".concat(-r,"px"):"";return j("div",{class:[d.e("slider"),f.e("slider")],style:{background:W.value[e._nodeId]},onClick:function(t){return X(e,t)},onDblclick:function(){return tt(e)},onContextmenu:function(t){return ht(e,t)}},[a&&j("div",{class:f.em("slider","caption"),style:{marginLeft:o},title:a,innerHTML:a},null)])}}});return[].concat(b(t),[e])},renderGanttCell:function(t){if(1===t.level){var e=i.getRowState(t.row._id)||{},n=at(e,i.state.capacityConfig);if(rt(t.column.date,n.weekdays)){var r={};return Object.assign(r,o(o({},t),{},{row:e})),j(pt,{cellData:r,showText:i.state.showCapacity,capacityConfig:n,onCellClick:dt},null)}}},renderGanttTitle:function(t){var e,n,r=t.column,a=function(t){var e=new Date(t);return["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][K(e).day()]}(r.date),o=(e=r.date,n="MM/DD",K(e).format(n));return j("div",{class:[d.b("column-title"),et(r.date)?d.be("column-title","today"):""]},[j("div",{class:d.be("column-title","top")},[a]),j("div",{class:d.be("column-title","bottom")},[o])])},onSliderMove:function(t){var e,n=null===(e=t[0])||void 0===e?void 0:e.row,r={begin:n._beginDataItemValue?K(n._beginDataItemValue).format("YYYY-MM-DD HH:mm:ss"):void 0,end:n._endDataItemValue?K(n._endDataItemValue).format("YYYY-MM-DD HH:mm:ss"):void 0};h.value=!0,i._evt.emit("onSliderMove",n),i.modifyNodeTime(n,r)},renderNoData:function(){return i.state.isLoaded&&j(G("iBizNoData"),{text:i.model.emptyText,emptyTextLanguageRes:i.model.emptyTextLanguageRes},null)},onVirtualTableChange:function(t){O.value=t,S()}}},render:function(){var t,e=this;return this.isInited?W(j(G("iBizControlBase"),{ref:"ganttBoxRef",controller:this.c,class:[this.ns.b(),this.ns2.b(),null!==(t=this.data)&&void 0!==t&&t.length?"":this.ns.m("empty"),this.ns.is("gantt-width-eq",this.isGanttWidthEq)]},{default:function(){return[j(G("x-gantt"),{ref:"ganttRef",id:e.ganttId,"data-id":"_id",data:e.data,"row-height":46,"show-expand":!0,"expand-all":e.c.state.expandAll,"start-key":"_beginDataItemValue","end-key":"_endDataItemValue",children:"_children",leaf:"_leaf",dateRange:e.c.state.dateRange,showWeekdays:e.c.state.showWeekdays,locale:e.locale,"header-height":46,showCheckbox:!e.c.state.singleSelect,showToday:!1,showWeekend:!1,onNodeExpand:e.onNodeExpand,onNodeCollapse:e.onNodeCollapse,onRowClick:e.onNodeClick,onRowDblClick:e.onNodeDbClick,onRowChecked:e.onCheck,onMoveSlider:e.onSliderMove,onVirtualTableChange:e.onVirtualTableChange,primaryColor:e.ganttStyle.primaryColor,headerStyle:{textColor:e.ganttStyle.textColor}},{default:function(){return e.renderContent()},ganttCell:function(t){return e.renderGanttCell(t)},ganttTitle:function(t){return e.renderGanttTitle(t)},empty:function(){return e.renderNoData()}})]}}),[[$("loading"),this.loading]]):null}}),Vt=d((function t(){s(this,t),i(this,"component","IBizResourceGanttControl")})),Pt=t("IBizResourceGanttControl",R(jt,(function(t){t.component(jt.name,jt),T("TREE_RENDER_RESOURCE_GANTT",(function(){return new Vt}))})));t("default",{install:function(t){t.use(Pt),t.use(Tt),t.use(Mt)}})}}}))}();
