# 自动规则插件

该插件基于下拉列表框增强，主要用于根据配置的代码表项的属性来决定该属性的变动规则。

## 界面展示

![image-20240605102959892](public/assets/images/scene.png)

## 主要功能与逻辑

在配置了代码表后，首先会以普通下拉列表展示代码表的数据，当选择了数据之后，会根据选择的数据呈现以下几种情况：

1.当选择的项的标识是以【.*】结尾的，则需要找出当前代码表中当前项的所有子项属性，并构建一个数组，然后作为子属性下拉列表的数据并显示，此时，不抛值；当子属性选择了数据之后，当前项会将选中的子属性下拉列表项的标识作为值抛出，同时，根据选择的子属性的数据，又会有以下几种情况：

(1).当选择的子属性配置了下拉列表，则会根据配置的代码表名称去加载新的代码表数据作为第三个和第四个下拉列表的数据源。其中，下拉列表里默认会添加一个【任何】作为下拉选项，如果选择的子属性配置了【允许为空】,则还会增加一个名为【空】的待选项。当第三或第四个下拉列表选择了值时，会在当前表单项的值项上抛出选着数据，这其中又分为一下几种情况：

   [1]. 如果第三和第四都选择了【任何】，则抛出一个拥有两个空字符串元素的数组 ['','']，第一个元素表示变动前，第二个元素表示变动后。

   [2].如果有一方选择了【空】，则对应的项变为null，例如: `['',null]`，表示由【任何】变为【空】。

   [3].其他情况则会抛出对应的下拉值，例如   `['a','b']`，表示由值【a】变为值【b】。

(2).当选择的子属性未配置代码表，同时配置了【不允许为空】，则不显示其他下拉框，当前表单项的值项直接抛值  ['','']，表示【任何】到【任何】。

(3).当选择的子属性未配置代码表，同时配置了【允许为空】，则显示一个新的下拉框，数据源为模拟仿真的下拉选项，包括【从任何到任何】，【从有值到空值】，【从空值到有值】共3个选项，抛出的值格式与之前一致。

2.当选择的项的标识不是以【.*】结尾的，则后续逻辑与选择了子属性下拉列表项后一致。

##  附录

## 自动规则插件

```
[
  {
    "plugintype": "EDITOR_CUSTOMSTYLE",
    "rtobjectrepo": "@ibiz-template-plm/auto-rules@0.0.3-dev.215",
    "codename": "UsrPFPlugin0603086182",
    "plugintag": "AUTO_RULES",
    "rtobjectmode": 2,
    "rtobjectname": "AutoRules",
    "pssyspfpluginname": "自动规则"
  }
]
```

### 编辑器样式

```
[
  {
    "codename": "AUTO_RULES",
    "pssyspfpluginid": "UsrPFPlugin0603086182",
    "repdefault": 0,
    "validflag": 1,
    "pssyseditorstylename": "自动规则",
    "pseditortypeid": "DROPDOWNLIST"
  }
]
```

